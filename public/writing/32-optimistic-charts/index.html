<!DOCTYPE html>
<html lang="en-us"
  dir="ltr">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">








    






<link rel="icon" type="image/ico" href="http:/localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http:/localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http:/localhost:1313/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="192x192" href="http:/localhost:1313/android-chrome-192x192.png">
<link rel="apple-touch-icon" sizes="180x180" href="http:/localhost:1313/apple-touch-icon.png">

<meta name="description" content="Data-driven evidence that humanity is making remarkable progress across health, education, technology, and human rights."/>



<title>
    
    32 Optimistic Charts: The World is Getting Better | Dominik Dabrowski
    
</title>

<link rel="canonical" href="http://localhost:1313/writing/32-optimistic-charts/"/>

<meta property="og:url" content="http://localhost:1313/writing/32-optimistic-charts/">
  <meta property="og:site_name" content="Dominik Dabrowski">
  <meta property="og:title" content="32 Optimistic Charts: The World is Getting Better">
  <meta property="og:description" content="Data-driven evidence that humanity is making remarkable progress across health, education, technology, and human rights.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="writing">
    <meta property="article:published_time" content="2025-08-17T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-08-17T00:00:00+00:00">
    <meta property="article:tag" content="Progress">
    <meta property="article:tag" content="Data">
    <meta property="article:tag" content="Optimism">












  







<link rel="stylesheet" href="/assets/combined.min.2320aae6ebf8845da1c3f982267540bc26ec33afcdf9b101c06e070ac6838975.css" media="all">











    




</head>







<body class="auto">

  <div class="content">
    <header>
      

<div class="header">

    

    <h1 class="header-title">
        <a href="http://localhost:1313/">Dominik Dabrowski</a>
    </h1>

    <div class="header-menu">
        

        
        

        <p
            class="small ">
            <a href="/" >
                /home
            </a>
        </p>
        

        <p
            class="small ">
            <a href="/writing" >
                /writing
            </a>
        </p>
        
        
    </div>

    

</div>

    </header>

    <main class="main">
      

<script>
  
  document.documentElement.setAttribute('data-wide-layout', 'true');
</script>




<div class="breadcrumbs"><a href="/">Home</a><span class="breadcrumbs-separator">/</span><a href="/writing/">Writings</a><span class="breadcrumbs-separator">/</span>
        <a href="/writing/32-optimistic-charts/">32 Optimistic Charts: The World is Getting Better</a></div>


<div class="wide-layout" >
  <article>
    <header class="single-intro-container">
        
        <h1 class="single-title">32 Optimistic Charts: The World is Getting Better</h1>
    
        <p class="single-readtime">
          <time datetime="2025-08-17T00:00:00&#43;00:00">August 17, 2025</time>
        </p>
    </header>
    
    <div class="single-content wide-content">
      <p>The world often feels like it&rsquo;s falling apart, but the data tells a different story. Here are 32 charts showing measurable human progress across health, education, technology, environment, and human rights.</p>
<p><em>Last updated: 2025-08-17</em></p>
<h2 class="heading" id="16-bad-things-that-are-decreasing">
  16 Bad Things That Are Decreasing
  <a class="anchor" href="#16-bad-things-that-are-decreasing">#</a>
</h2>
<div class="charts-grid">
<div class="chart-section">
<div class="chart-section-header">
<h3 class="heading" id="maternal-deaths">
  Maternal Deaths
  <a class="anchor" href="#maternal-deaths">#</a>
</h3>
<p>Deaths per 100,000 live births</p>
</div>
<div class="chart-container" id="chart-maternal-mortality"><div class="chart-visualization" id="chart-viz-maternal-mortality"></div>
  <script>
    (function() {
      const data = [{year:  1985 , value:  428.5482 },{year:  1986 , value:  410.23654 },{year:  1987 , value:  401.5882 },{year:  1988 , value:  396.0917 },{year:  1989 , value:  384.8084 },{year:  1990 , value:  370.27313 },{year:  1991 , value:  378.09518 },{year:  1992 , value:  386.26517 },{year:  1993 , value:  385.65283 },{year:  1994 , value:  375.2249 },{year:  1995 , value:  373.19336 },{year:  1996 , value:  372.66693 },{year:  1997 , value:  365.62094 },{year:  1998 , value:  362.9174 },{year:  1999 , value:  343.77753 },{year:  2000 , value:  334.10532 },{year:  2001 , value:  329.2917 },{year:  2002 , value:  317.67972 },{year:  2003 , value:  307.0511 },{year:  2004 , value:  299.8426 },{year:  2005 , value:  291.26068 },{year:  2006 , value:  276.11456 },{year:  2007 , value:  270.64816 },{year:  2008 , value:  265.16806 },{year:  2009 , value:  258.04745 },{year:  2010 , value:  248.80334 },{year:  2011 , value:  241.46191 },{year:  2012 , value:  231.28264 },{year:  2013 , value:  228.95949 },{year:  2014 , value:  223.14148 },{year:  2015 , value:  219.4542 },{year:  2016 , value:  215.49913 },{year:  2017 , value:  213.16835 },{year:  2018 , value:  215.09969 },{year:  2019 , value:  214.92525 },{year:  2020 , value:  212.23637 },];
      
      const direction = "down";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-maternal-mortality");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<div class="chart-section-header">
<h3 class="heading" id="oil-spills">
  Oil Spills
  <a class="anchor" href="#oil-spills">#</a>
</h3>
<p>1,000 tons spilled per year</p>
</div>
<div class="chart-container" id="chart-oil-spills"><div class="chart-visualization" id="chart-viz-oil-spills"></div>
  <script>
    (function() {
      const data = [{year:  1970 , value:  383 },{year:  1972 , value:  313 },{year:  1974 , value:  174 },{year:  1976 , value:  365 },{year:  1978 , value:  393 },{year:  1980 , value:  206 },{year:  1982 , value:  12 },{year:  1984 , value:  29 },{year:  1986 , value:  19 },{year:  1988 , value:  190 },{year:  1990 , value:  61 },{year:  1992 , value:  167 },{year:  1994 , value:  130 },{year:  1996 , value:  80 },{year:  1998 , value:  13 },{year:  2000 , value:  14 },{year:  2002 , value:  66 },{year:  2004 , value:  17 },{year:  2006 , value:  12 },{year:  2008 , value:  2 },{year:  2010 , value:  12 },{year:  2012 , value:  1 },{year:  2014 , value:  5 },{year:  2016 , value:  6 },{year:  2018 , value:  116 },{year:  2020 , value:  1 },{year:  2022 , value:  15 },{year:  2024 , value:  10 },];
      
      const direction = "down";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-oil-spills");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<div class="chart-section-header">
<h3 class="heading" id="solar-panel-price">
  Solar Panel Price
  <a class="anchor" href="#solar-panel-price">#</a>
</h3>
<p>Average price of PV modules, $/W</p>
</div>
<div class="chart-container" id="chart-solar-price"><div class="chart-visualization" id="chart-viz-solar-price"></div>
  <script>
    (function() {
      const data = [{year:  1975 , value:  130.70473 },{year:  1977 , value:  71.74392 },{year:  1979 , value:  42.64987 },{year:  1981 , value:  28.896935 },{year:  1983 , value:  20.960136 },{year:  1985 , value:  17.003012 },{year:  1987 , value:  11.957518 },{year:  1989 , value:  11.542489 },{year:  1991 , value:  11.059409 },{year:  1993 , value:  9.635483 },{year:  1995 , value:  8.427791 },{year:  1997 , value:  7.8516297 },{year:  1999 , value:  6.5357065 },{year:  2001 , value:  6.2051206 },{year:  2003 , value:  5.3948364 },{year:  2005 , value:  4.569292 },{year:  2007 , value:  5.0173874 },{year:  2009 , value:  3.0563195 },{year:  2011 , value:  1.9594005 },{year:  2013 , value:  0.81395847 },{year:  2015 , value:  0.697721 },{year:  2017 , value:  0.5409895 },{year:  2019 , value:  0.44111046 },{year:  2021 , value:  0.31517783 },{year:  2023 , value:  0.3056964 },];
      
      const direction = "down";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-solar-price");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="child-mortality">
  Child Mortality
  <a class="anchor" href="#child-mortality">#</a>
</h3>
<p>Children dying before age 5, percent</p>
<div class="chart-container" id="chart-child-mortality"><div class="chart-visualization" id="chart-viz-child-mortality"></div>
  <script>
    (function() {
      const data = [{year:  1800 , value:  42.8 },{year:  1811 , value:  42.4 },{year:  1822 , value:  42.1 },{year:  1833 , value:  42.2 },{year:  1844 , value:  42.1 },{year:  1855 , value:  44 },{year:  1866 , value:  42.1 },{year:  1877 , value:  41.2 },{year:  1888 , value:  41 },{year:  1899 , value:  40.8 },{year:  1910 , value:  36.4 },{year:  1921 , value:  34.2 },{year:  1932 , value:  30.7 },{year:  1943 , value:  27.7 },{year:  1954 , value:  22.8 },{year:  1965 , value:  15.1 },{year:  1976 , value:  12.8 },{year:  1987 , value:  9.94 },{year:  1998 , value:  8.23 },{year:  2009 , value:  5.4 },{year:  2020 , value:  3.87 },{year:  2023 , value:  3.67 },];
      
      const direction = "down";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-child-mortality");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="battle-deaths">
  Battle Deaths
  <a class="anchor" href="#battle-deaths">#</a>
</h3>
<p>Deaths in state conflicts per 100,000 people</p>
<div class="chart-container" id="chart-battle-deaths"><div class="chart-visualization" id="chart-viz-battle-deaths"></div>
  <script>
    (function() {
      const data = [{year:  1946 , value:  1.7845484 },{year:  1949 , value:  1.761051 },{year:  1952 , value:  1.7986227 },{year:  1955 , value:  0.8757755 },{year:  1958 , value:  0.8398103 },{year:  1961 , value:  0.8482149 },{year:  1964 , value:  0.2313092 },{year:  1967 , value:  0.23980215 },{year:  1970 , value:  0.21728988 },{year:  1973 , value:  0.2496556 },{year:  1976 , value:  0 },{year:  1979 , value:  0 },{year:  1982 , value:  0 },{year:  1985 , value:  0 },{year:  1988 , value:  0 },{year:  1991 , value:  0 },{year:  1994 , value:  0 },{year:  1997 , value:  0 },{year:  2000 , value:  0 },{year:  2003 , value:  0 },{year:  2006 , value:  0 },{year:  2009 , value:  0 },{year:  2012 , value:  0 },{year:  2015 , value:  0 },{year:  2018 , value:  0 },{year:  2021 , value:  0 },{year:  2024 , value:  0 },];
      
      const direction = "down";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-battle-deaths");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="co-intensity">
  CO Intensity
  <a class="anchor" href="#co-intensity">#</a>
</h3>
<p>Carbon emissions per dollar of GDP</p>
<div class="chart-container" id="chart-co2-intensity"><div class="chart-visualization" id="chart-viz-co2-intensity"></div>
  <script>
    (function() {
      const data = [{year:  1820 , value:  0.043172903 },{year:  1850 , value:  0.12727068 },{year:  1870 , value:  0.27310827 },{year:  1900 , value:  0.55983275 },{year:  1920 , value:  0.7332383 },{year:  1940 , value:  0.6387778 },{year:  1950 , value:  0.7008459 },{year:  1960 , value:  0.70377547 },{year:  1970 , value:  0.6790251 },{year:  1980 , value:  0.60934746 },{year:  1990 , value:  0.5281683 },{year:  2000 , value:  0.42590228 },{year:  2010 , value:  0.3714147 },{year:  2015 , value:  0.33128375 },{year:  2016 , value:  0.32078212 },{year:  2017 , value:  0.31424102 },{year:  2018 , value:  0.30926767 },{year:  2019 , value:  0.3037615 },{year:  2020 , value:  0.29620138 },{year:  2021 , value:  0.29357404 },{year:  2022 , value:  0.28662747 },];
      
      const direction = "down";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-co2-intensity");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="plane-crash-deaths">
  Plane Crash Deaths
  <a class="anchor" href="#plane-crash-deaths">#</a>
</h3>
<p>Aviation deaths per 10 billion passengermiles</p>
<div class="chart-container" id="chart-plane-deaths"><div class="chart-visualization" id="chart-viz-plane-deaths"></div>
  <script>
    (function() {
      const data = [{year:  1942 , value:  0 },{year:  1946 , value:  0 },{year:  1950 , value:  0 },{year:  1954 , value:  2 },{year:  1958 , value:  19 },{year:  1962 , value:  0 },{year:  1966 , value:  2 },{year:  1970 , value:  7 },{year:  1974 , value:  83 },{year:  1978 , value:  4 },{year:  1982 , value:  1 },{year:  1986 , value:  87 },{year:  1990 , value:  86 },{year:  1994 , value:  8 },{year:  1998 , value:  1 },{year:  2002 , value:  2 },{year:  2006 , value:  0 },{year:  2010 , value:  0 },{year:  2014 , value:  0 },{year:  2018 , value:  0 },{year:  2021 , value:  0 },];
      
      const direction = "down";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-plane-deaths");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="disaster-deaths">
  Disaster Deaths
  <a class="anchor" href="#disaster-deaths">#</a>
</h3>
<p>Natural disaster deaths, thousands per year</p>
<div class="chart-container" id="chart-disaster-deaths"><div class="chart-visualization" id="chart-viz-disaster-deaths"></div>
  <script>
    (function() {
      const data = [{year:  1900 , value:  1261000 },{year:  1910 , value:  16990 },{year:  1914 , value:  17040 },{year:  1922 , value:  0 },{year:  1932 , value:  0 },{year:  1936 , value:  0 },{year:  1940 , value:  4006 },{year:  1944 , value:  4009 },{year:  1961 , value:  0 },{year:  1966 , value:  508000 },{year:  1970 , value:  0 },{year:  1974 , value:  20427 },{year:  1978 , value:  19774 },{year:  1982 , value:  20988 },{year:  1986 , value:  84 },{year:  1990 , value:  42 },{year:  1994 , value:  0 },{year:  1998 , value:  65 },{year:  2002 , value:  671 },{year:  2006 , value:  169 },{year:  2010 , value:  10000 },{year:  2014 , value:  0 },{year:  2018 , value:  0 },{year:  2022 , value:  2601 },{year:  2024 , value:  0 },];
      
      const direction = "down";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-disaster-deaths");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="nuclear-warheads">
  Nuclear Warheads
  <a class="anchor" href="#nuclear-warheads">#</a>
</h3>
<p>Global nuclear weapons, thousands</p>
<div class="chart-container" id="chart-nuclear-warheads"><div class="chart-visualization" id="chart-viz-nuclear-warheads"></div>
  <script>
    (function() {
      const data = [{year:  1945 , value:  6 },{year:  1949 , value:  236 },{year:  1953 , value:  1557 },{year:  1957 , value:  7162 },{year:  1961 , value:  26752 },{year:  1965 , value:  38419 },{year:  1969 , value:  38278 },{year:  1973 , value:  45695 },{year:  1977 , value:  49698 },{year:  1981 , value:  56530 },{year:  1985 , value:  64408 },{year:  1989 , value:  63657 },{year:  1993 , value:  48830 },{year:  1997 , value:  36776 },{year:  2001 , value:  33190 },{year:  2005 , value:  28358 },{year:  2009 , value:  22524 },{year:  2013 , value:  17680 },{year:  2017 , value:  14540 },{year:  2021 , value:  13100 },{year:  2024 , value:  12121 },];
      
      const direction = "down";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-nuclear-warheads");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="air-pollution">
  Air Pollution
  <a class="anchor" href="#air-pollution">#</a>
</h3>
<p>Sulfur dioxide emissions, kg per person</p>
<div class="chart-container" id="chart-so2-emissions"><div class="chart-visualization" id="chart-viz-so2-emissions"></div>
  <script>
    (function() {
      const data = [{year:  1750 , value:  372348.8 },{year:  1763 , value:  400937.75 },{year:  1776 , value:  460547.53 },{year:  1789 , value:  522329.72 },{year:  1802 , value:  660536.7 },{year:  1815 , value:  783391.44 },{year:  1828 , value:  1028865.5 },{year:  1841 , value:  1619054.8 },{year:  1854 , value:  2820843.8 },{year:  1867 , value:  5153144 },{year:  1880 , value:  9752826 },{year:  1893 , value:  15644939 },{year:  1906 , value:  30750544 },{year:  1919 , value:  34120736 },{year:  1932 , value:  32253812 },{year:  1945 , value:  47722824 },{year:  1958 , value:  79369420 },{year:  1971 , value:  124511130 },{year:  1984 , value:  131849490 },{year:  1997 , value:  117210260 },{year:  2010 , value:  105690750 },{year:  2022 , value:  73466960 },];
      
      const direction = "down";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-so2-emissions");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="ozone-depletion">
  Ozone Depletion
  <a class="anchor" href="#ozone-depletion">#</a>
</h3>
<p>Ozone-depleting substances, thousands of tons</p>
<div class="chart-container" id="chart-ozone-depletion"><div class="chart-visualization" id="chart-viz-ozone-depletion"></div>
  <script>
    (function() {
      const data = [{year:  1986 , value:  4.6 },{year:  1989 , value:  65667.4 },{year:  1990 , value:  16754 },{year:  1991 , value:  35873.2 },{year:  1992 , value:  56687.7 },{year:  1993 , value:  38083.8 },{year:  1994 , value:  14215.7 },{year:  1995 , value:  15455.899 },{year:  1996 , value:  2896.8 },{year:  1997 , value:  2295 },{year:  1998 , value:  1732.8999 },{year:  1999 , value:  2155.7998 },{year:  2000 , value:  2119.5 },{year:  2001 , value:  1322.5 },{year:  2002 , value:  -599.49994 },{year:  2003 , value:  1330.4 },{year:  2004 , value:  799.9 },{year:  2005 , value:  618.30005 },{year:  2006 , value:  613.4 },{year:  2007 , value:  491.1 },{year:  2008 , value:  387 },{year:  2009 , value:  235.90001 },{year:  2010 , value:  -20.300003 },{year:  2011 , value:  -107.9 },{year:  2012 , value:  -117.8 },{year:  2013 , value:  -25.5 },{year:  2014 , value:  -6.1 },{year:  2015 , value:  -22.4 },{year:  2016 , value:  -31.4 },{year:  2017 , value:  -46.8 },{year:  2018 , value:  -41.2 },{year:  2019 , value:  -37.6 },{year:  2020 , value:  -32.3 },{year:  2021 , value:  -21.7 },];
      
      const direction = "down";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-ozone-depletion");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="hunger">
  Hunger
  <a class="anchor" href="#hunger">#</a>
</h3>
<p>Population undernourished, percent</p>
<div class="chart-container" id="chart-hunger"><div class="chart-visualization" id="chart-viz-hunger"></div>
  <script>
    (function() {
      const data = [{year:  2000 , value:  12.8 },{year:  2001 , value:  12.9 },{year:  2002 , value:  13.2 },{year:  2003 , value:  12.9 },{year:  2004 , value:  12.7 },{year:  2005 , value:  12.2 },{year:  2006 , value:  11.2 },{year:  2007 , value:  10.1 },{year:  2008 , value:  9.5 },{year:  2009 , value:  9.2 },{year:  2010 , value:  8.7 },{year:  2011 , value:  8.1 },{year:  2012 , value:  8 },{year:  2013 , value:  7.8 },{year:  2014 , value:  7.3 },{year:  2015 , value:  7.7 },{year:  2016 , value:  7.6 },{year:  2017 , value:  7.1 },{year:  2018 , value:  7.2 },{year:  2019 , value:  7.5 },{year:  2020 , value:  8.5 },{year:  2021 , value:  9 },{year:  2022 , value:  9.1 },{year:  2023 , value:  9.1 },];
      
      const direction = "down";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-hunger");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="extreme-poverty">
  Extreme Poverty
  <a class="anchor" href="#extreme-poverty">#</a>
</h3>
<p>Population in extreme poverty, percent</p>
<div class="chart-container" id="chart-extreme-poverty"><div class="chart-visualization" id="chart-viz-extreme-poverty"></div>
  <script>
    (function() {
      const data = [{year:  1990 , value:  43.62347 },{year:  1991 , value:  43.308975 },{year:  1992 , value:  42.646713 },{year:  1993 , value:  42.162754 },{year:  1994 , value:  40.751804 },{year:  1995 , value:  39.29992 },{year:  1996 , value:  37.99766 },{year:  1997 , value:  37.6325 },{year:  1998 , value:  37.821438 },{year:  1999 , value:  37.296734 },{year:  2000 , value:  36.258648 },{year:  2001 , value:  35.3276 },{year:  2002 , value:  33.82348 },{year:  2003 , value:  32.322193 },{year:  2004 , value:  30.390305 },{year:  2005 , value:  28.426996 },{year:  2006 , value:  27.02685 },{year:  2007 , value:  25.348526 },{year:  2008 , value:  24.160345 },{year:  2009 , value:  23.068974 },{year:  2010 , value:  20.992023 },{year:  2011 , value:  19.143898 },{year:  2012 , value:  17.860125 },{year:  2013 , value:  15.481716 },{year:  2014 , value:  14.438818 },{year:  2015 , value:  13.338141 },{year:  2016 , value:  12.48118 },{year:  2017 , value:  11.723499 },{year:  2018 , value:  11.059525 },{year:  2019 , value:  10.694138 },{year:  2020 , value:  11.221615 },{year:  2021 , value:  10.967278 },{year:  2022 , value:  10.48834 },{year:  2023 , value:  10.192862 },{year:  2024 , value:  10.044863 },{year:  2025 , value:  9.856213 },];
      
      const direction = "down";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-extreme-poverty");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
</div>
<h2 class="heading" id="16-good-things-that-are-increasing">
  16 Good Things That Are Increasing
  <a class="anchor" href="#16-good-things-that-are-increasing">#</a>
</h2>
<div class="charts-grid">
<div class="chart-section">
<h3 class="heading" id="protected-nature">
  Protected Nature
  <a class="anchor" href="#protected-nature">#</a>
</h3>
<p>Land area protected as reserves, percent</p>
<div class="chart-container" id="chart-protected-areas"><div class="chart-visualization" id="chart-viz-protected-areas"></div>
  <script>
    (function() {
      const data = [{year:  2016 , value:  14.400239 },{year:  2017 , value:  14.572377 },{year:  2018 , value:  14.572405 },{year:  2019 , value:  14.701448 },{year:  2020 , value:  14.75412 },{year:  2021 , value:  15.272336 },];
      
      const direction = "up";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-protected-areas");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="scientific-research">
  Scientific Research
  <a class="anchor" href="#scientific-research">#</a>
</h3>
<p>Scholarly articles published per year</p>
<div class="chart-container" id="chart-scientific-papers"><div class="chart-visualization" id="chart-viz-scientific-papers"></div>
  <script>
    (function() {
      const data = [{year:  1996 , value:  984812.2 },{year:  1997 , value:  1014880.06 },{year:  1998 , value:  1020474.94 },{year:  1999 , value:  1020833.56 },{year:  2000 , value:  1071009.5 },{year:  2001 , value:  1109618.4 },{year:  2002 , value:  1158076.9 },{year:  2003 , value:  1214597.9 },{year:  2004 , value:  1327931.2 },{year:  2005 , value:  1489848 },{year:  2006 , value:  1580500.6 },{year:  2007 , value:  1648986.1 },{year:  2008 , value:  1742799 },{year:  2009 , value:  1844539.1 },{year:  2010 , value:  1929771.1 },{year:  2011 , value:  2028062.9 },{year:  2012 , value:  2083570.1 },{year:  2013 , value:  2149755.8 },{year:  2014 , value:  2223226.5 },{year:  2015 , value:  2275681.2 },{year:  2016 , value:  2356514.8 },{year:  2017 , value:  2430534 },{year:  2018 , value:  2565871.5 },{year:  2019 , value:  2734961.8 },{year:  2020 , value:  2933010.8 },];
      
      const direction = "up";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-scientific-papers");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="food-production">
  Food Production
  <a class="anchor" href="#food-production">#</a>
</h3>
<p>Cereal crop yield, tonnes per hectare</p>
<div class="chart-container" id="chart-cereal-yield"><div class="chart-visualization" id="chart-viz-cereal-yield"></div>
  <script>
    (function() {
      const data = [{year:  1961 , value:  1.3532 },{year:  1964 , value:  1.4938002 },{year:  1967 , value:  1.6533002 },{year:  1970 , value:  1.7655001 },{year:  1973 , value:  1.9404001 },{year:  1976 , value:  2.0259001 },{year:  1979 , value:  2.1761003 },{year:  1982 , value:  2.3693001 },{year:  1985 , value:  2.5288002 },{year:  1988 , value:  2.4599 },{year:  1991 , value:  2.6832001 },{year:  1994 , value:  2.8226001 },{year:  1997 , value:  2.9945002 },{year:  2000 , value:  3.0679 },{year:  2003 , value:  3.0926003 },{year:  2006 , value:  3.3075001 },{year:  2009 , value:  3.5547001 },{year:  2012 , value:  3.6144001 },{year:  2015 , value:  3.9253001 },{year:  2018 , value:  4.0291004 },{year:  2021 , value:  4.1604 },{year:  2023 , value:  4.2426004 },];
      
      const direction = "up";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-cereal-yield");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="adult-literacy">
  Adult Literacy
  <a class="anchor" href="#adult-literacy">#</a>
</h3>
<p>Population that can read and write, percent</p>
<div class="chart-container" id="chart-literacy"><div class="chart-visualization" id="chart-viz-literacy"></div>
  <script>
    (function() {
      const data = [{year:  1976 , value:  65.65878 },{year:  1978 , value:  66.57206 },{year:  1980 , value:  67.84755 },{year:  1982 , value:  69.04214 },{year:  1984 , value:  70.27237 },{year:  1986 , value:  71.41604 },{year:  1988 , value:  73.82409 },{year:  1990 , value:  74.90692 },{year:  1992 , value:  75.69422 },{year:  1994 , value:  76.50139 },{year:  1996 , value:  77.29624 },{year:  1998 , value:  80.46865 },{year:  2000 , value:  80.97918 },{year:  2002 , value:  81.64014 },{year:  2004 , value:  82.44724 },{year:  2006 , value:  82.42525 },{year:  2008 , value:  83.38551 },{year:  2010 , value:  84.22716 },{year:  2012 , value:  84.60138 },{year:  2014 , value:  85.28639 },{year:  2016 , value:  86.00011 },{year:  2018 , value:  86.43748 },{year:  2020 , value:  86.74745 },{year:  2022 , value:  87.15533 },{year:  2023 , value:  87.356 },];
      
      const direction = "up";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-literacy");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="democracy">
  Democracy
  <a class="anchor" href="#democracy">#</a>
</h3>
<p>Population living in democratic countries, percent</p>
<div class="chart-container" id="chart-democracy"><div class="chart-visualization" id="chart-viz-democracy"></div>
  <script>
    (function() {
      const data = [{year:  1789 , value:  0 },{year:  1800 , value:  0 },{year:  1811 , value:  0 },{year:  1822 , value:  0 },{year:  1833 , value:  0 },{year:  1844 , value:  0 },{year:  1855 , value:  0 },{year:  1866 , value:  0 },{year:  1877 , value:  38562323 },{year:  1888 , value:  40018115 },{year:  1899 , value:  40762987 },{year:  1910 , value:  43869795 },{year:  1921 , value:  269171560 },{year:  1932 , value:  297308342 },{year:  1943 , value:  148583345 },{year:  1954 , value:  626331361 },{year:  1965 , value:  818886050 },{year:  1976 , value:  90630605 },{year:  1987 , value:  1056568758 },{year:  1998 , value:  1940693474 },{year:  2009 , value:  2230990836 },{year:  2020 , value:  1525178859 },{year:  2024 , value:  1351854565 },];
      
      const direction = "up";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-democracy");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="girls-education">
  Girls&rsquo; Education
  <a class="anchor" href="#girls-education">#</a>
</h3>
<p>Primary school enrollment rate, percent</p>
<div class="chart-container" id="chart-girls-school"><div class="chart-visualization" id="chart-viz-girls-school"></div>
  <script>
    (function() {
      const data = [{year:  1970 , value:  0.84016 },{year:  1972 , value:  0.79965 },{year:  1974 , value:  0.79201 },{year:  1976 , value:  0.83173 },{year:  1978 , value:  0.81504 },{year:  1980 , value:  0.81496 },{year:  1982 , value:  0.83338 },{year:  1984 , value:  0.85876 },{year:  1986 , value:  0.8908 },{year:  1988 , value:  0.90111 },{year:  1990 , value:  0.90292 },{year:  1992 , value:  0.90683 },{year:  1994 , value:  0.9158 },{year:  1996 , value:  0.91734 },{year:  1998 , value:  0.93585 },{year:  2000 , value:  0.94073 },{year:  2002 , value:  0.94699 },{year:  2004 , value:  0.966 },{year:  2006 , value:  0.97191 },{year:  2008 , value:  0.97863 },{year:  2010 , value:  0.98475 },{year:  2012 , value:  0.9816 },{year:  2014 , value:  0.97883 },{year:  2016 , value:  0.97548 },{year:  2018 , value:  0.97063 },{year:  2020 , value:  0.97528 },{year:  2022 , value:  0.97345 },{year:  2023 , value:  0.97313 },];
      
      const direction = "up";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-girls-school");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="electricity-access">
  Electricity Access
  <a class="anchor" href="#electricity-access">#</a>
</h3>
<p>Population with electrical power, percent</p>
<div class="chart-container" id="chart-electricity"><div class="chart-visualization" id="chart-viz-electricity"></div>
  <script>
    (function() {
      const data = [{year:  1998 , value:  73.196236 },{year:  1999 , value:  74.50321 },{year:  2000 , value:  78.2214 },{year:  2001 , value:  78.71523 },{year:  2002 , value:  79.10069 },{year:  2003 , value:  79.96463 },{year:  2004 , value:  79.951706 },{year:  2005 , value:  80.700745 },{year:  2006 , value:  81.35274 },{year:  2007 , value:  81.9703 },{year:  2008 , value:  82.66719 },{year:  2009 , value:  82.86468 },{year:  2010 , value:  83.445724 },{year:  2011 , value:  84.50422 },{year:  2012 , value:  84.933945 },{year:  2013 , value:  85.70948 },{year:  2014 , value:  86.195206 },{year:  2015 , value:  86.923546 },{year:  2016 , value:  88.10383 },{year:  2017 , value:  88.9311 },{year:  2018 , value:  89.79635 },{year:  2019 , value:  90.10693 },{year:  2020 , value:  90.39738 },{year:  2021 , value:  91.33499 },{year:  2022 , value:  91.277855 },];
      
      const direction = "up";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-electricity");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="mobile-communications">
  Mobile Communications
  <a class="anchor" href="#mobile-communications">#</a>
</h3>
<p>Mobile phone subscriptions, percent</p>
<div class="chart-container" id="chart-mobile-phones"><div class="chart-visualization" id="chart-viz-mobile-phones"></div>
  <script>
    (function() {
      const data = [{year:  1960 , value:  0 },{year:  1970 , value:  0 },{year:  1976 , value:  0 },{year:  1978 , value:  0 },{year:  1980 , value:  0.00053235854 },{year:  1982 , value:  0.0023355952 },{year:  1984 , value:  0.0068745855 },{year:  1986 , value:  0.029605433 },{year:  1988 , value:  0.08511321 },{year:  1990 , value:  0.21159427 },{year:  1992 , value:  0.4277416 },{year:  1994 , value:  0.991495 },{year:  1996 , value:  2.4996634 },{year:  1998 , value:  5.333583 },{year:  2000 , value:  12.045212 },{year:  2002 , value:  18.50668 },{year:  2004 , value:  27.264036 },{year:  2006 , value:  41.7 },{year:  2008 , value:  59.7 },{year:  2010 , value:  76.6 },{year:  2012 , value:  88.5 },{year:  2014 , value:  96.7 },{year:  2016 , value:  99.3 },{year:  2018 , value:  103.1 },{year:  2020 , value:  105.5 },{year:  2022 , value:  108.1 },{year:  2023 , value:  110.6 },];
      
      const direction = "up";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-mobile-phones");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="clean-water">
  Clean Water
  <a class="anchor" href="#clean-water">#</a>
</h3>
<p>Population with safe water access, percent</p>
<div class="chart-container" id="chart-water-access"><div class="chart-visualization" id="chart-viz-water-access"></div>
  <script>
    (function() {
      const data = [{year:  2000 , value:  81.268005 },{year:  2001 , value:  81.60539 },{year:  2002 , value:  82.25051 },{year:  2003 , value:  82.76296 },{year:  2004 , value:  83.2708 },{year:  2005 , value:  83.76251 },{year:  2006 , value:  84.26049 },{year:  2007 , value:  84.75209 },{year:  2008 , value:  85.2404 },{year:  2009 , value:  85.71571 },{year:  2010 , value:  86.183 },{year:  2011 , value:  86.57294 },{year:  2012 , value:  87.01813 },{year:  2013 , value:  87.458954 },{year:  2014 , value:  87.893524 },{year:  2015 , value:  88.3615 },{year:  2016 , value:  88.78253 },{year:  2017 , value:  89.193 },{year:  2018 , value:  89.605576 },{year:  2019 , value:  90.004906 },{year:  2020 , value:  90.3829 },{year:  2021 , value:  90.80476 },{year:  2022 , value:  91.18254 },];
      
      const direction = "up";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-water-access");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="internet-access">
  Internet Access
  <a class="anchor" href="#internet-access">#</a>
</h3>
<p>Population using the internet, percent</p>
<div class="chart-container" id="chart-internet"><div class="chart-visualization" id="chart-viz-internet"></div>
  <script>
    (function() {
      const data = [{year:  1990 , value:  0.048824694 },{year:  1991 , value:  0.07881051 },{year:  1992 , value:  0.12518632 },{year:  1993 , value:  0.17900668 },{year:  1994 , value:  0.36050814 },{year:  1995 , value:  0.68308204 },{year:  1996 , value:  1.3265672 },{year:  1997 , value:  2.042697 },{year:  1998 , value:  3.1405797 },{year:  1999 , value:  4.6329026 },{year:  2000 , value:  6.720288 },{year:  2001 , value:  8.022651 },{year:  2002 , value:  10.478108 },{year:  2003 , value:  12.161165 },{year:  2004 , value:  14.037434 },{year:  2005 , value:  15.6 },{year:  2006 , value:  17.3 },{year:  2007 , value:  20.3 },{year:  2008 , value:  22.8 },{year:  2009 , value:  25.4 },{year:  2010 , value:  28.5 },{year:  2011 , value:  31 },{year:  2012 , value:  33.5 },{year:  2013 , value:  35.4 },{year:  2014 , value:  37.5 },{year:  2015 , value:  39.9 },{year:  2016 , value:  42.9 },{year:  2017 , value:  45.4 },{year:  2018 , value:  48.6 },{year:  2019 , value:  53.2 },{year:  2020 , value:  59.3 },{year:  2021 , value:  62.2 },{year:  2022 , value:  64.4 },{year:  2023 , value:  67.4 },];
      
      const direction = "up";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-internet");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="life-expectancy">
  Life Expectancy
  <a class="anchor" href="#life-expectancy">#</a>
</h3>
<p>Average lifespan at birth, years</p>
<div class="chart-container" id="chart-life-expectancy"><div class="chart-visualization" id="chart-viz-life-expectancy"></div>
  <script>
    (function() {
      const data = [{year:  1770 , value:  28.5 },{year:  1870 , value:  29.7 },{year:  1951 , value:  47.1259 },{year:  1955 , value:  50.2055 },{year:  1959 , value:  49.5818 },{year:  1963 , value:  53.7161 },{year:  1967 , value:  55.0678 },{year:  1971 , value:  56.0193 },{year:  1975 , value:  58.2681 },{year:  1979 , value:  60.1571 },{year:  1983 , value:  61.5211 },{year:  1987 , value:  63.1809 },{year:  1991 , value:  64.0642 },{year:  1995 , value:  64.8817 },{year:  1999 , value:  66.0412 },{year:  2003 , value:  67.4015 },{year:  2007 , value:  69.0316 },{year:  2011 , value:  70.4033 },{year:  2015 , value:  71.606 },{year:  2019 , value:  72.6093 },{year:  2023 , value:  73.1694 },];
      
      const direction = "up";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-life-expectancy");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="clean-energy">
  Clean Energy
  <a class="anchor" href="#clean-energy">#</a>
</h3>
<p>Renewable electricity generation, percent</p>
<div class="chart-container" id="chart-renewable-energy"><div class="chart-visualization" id="chart-viz-renewable-energy"></div>
  <script>
    (function() {
      const data = [{year:  1985 , value:  20.817406 },{year:  1987 , value:  19.913677 },{year:  1989 , value:  18.829807 },{year:  1991 , value:  19.107336 },{year:  1993 , value:  19.706957 },{year:  1995 , value:  19.720285 },{year:  1997 , value:  19.361753 },{year:  1999 , value:  18.75384 },{year:  2001 , value:  18.045189 },{year:  2003 , value:  17.44261 },{year:  2005 , value:  18.095892 },{year:  2007 , value:  17.97301 },{year:  2009 , value:  19.471212 },{year:  2011 , value:  20.02158 },{year:  2013 , value:  21.72934 },{year:  2015 , value:  23.005732 },{year:  2017 , value:  24.497082 },{year:  2019 , value:  26.128609 },{year:  2021 , value:  28.133307 },{year:  2023 , value:  30.261606 },{year:  2024 , value:  31.918001 },];
      
      const direction = "up";
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 20, right: 20, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-renewable-energy");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#f5f5f5");
      area.setAttribute("fill-opacity", "0.6");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#000000");
      line.setAttribute("stroke-width", "1.5");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#666666");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#666666");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#666666");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      data.forEach(d => {
        const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.setAttribute("cx", xScale(d.year));
        circle.setAttribute("cy", yScale(d.value));
        circle.setAttribute("r", "2");
        circle.setAttribute("fill", "#000000");
        
        
        const title = document.createElementNS("http://www.w3.org/2000/svg", "title");
        title.textContent = `${d.value.toFixed(1)} (${d.year})`;
        circle.appendChild(title);
        
        svg.appendChild(circle);
      });
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#000000");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.6");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 10 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "6");
        marker.setAttribute("markerHeight", "5");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L10,3 z");
        arrowPath.setAttribute("fill", "#000000");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const distanceAbove = 22; 
        const distanceBelow = 12; 
        const startDistance = config.start === "above" ? distanceAbove : distanceBelow;
        const endDistance = config.end === "above" ? distanceAbove : distanceBelow;

        
        const pts = data.map(d => ({ x: xScale(d.year), y: yScale(d.value) }));
        const yOnLine = (x) => {
          let best = pts[0];
          for (let i = 0; i < pts.length - 1; i++) {
            const p0 = pts[i], p1 = pts[i + 1];
            const minX = Math.min(p0.x, p1.x), maxX = Math.max(p0.x, p1.x);
            if (x >= minX && x <= maxX && maxX !== minX) {
              const t = (x - p0.x) / (p1.x - p0.x);
              return p0.y + t * (p1.y - p0.y);
            }
            
            if (Math.abs(x - p0.x) < Math.abs(x - best.x)) best = p0;
            if (Math.abs(x - p1.x) < Math.abs(x - best.x)) best = p1;
          }
          return best.y;
        };

        const clearanceAbove = 18; 
        const clearanceBelow = 10; 

        const adjustLabelPair = (valueEl, yearEl, x, side) => {
          
          const vb = valueEl.getBBox();
          const yb = yearEl.getBBox();
          const gap = 12;
          const blockH = vb.height + gap + yb.height;
          const yLine = yOnLine(x);

          if (side === 'above') {
            const bottom = yLine - clearanceAbove;
            const valueBaseline = bottom - yb.height - gap + (vb.height * 0.8);
            const yearBaseline = bottom - (yb.height * 0.2);
            valueEl.setAttribute('y', Math.max(margin.top + 15, valueBaseline));
            yearEl.setAttribute('y', Math.max(margin.top + 27, yearBaseline));
          } else { 
            const top = yLine + clearanceBelow;
            const valueBaseline = top + (vb.height * 0.8);
            const yearBaseline = valueBaseline + gap + (yb.height * 0.8);
            valueEl.setAttribute('y', Math.min(margin.top + height - 15, valueBaseline));
            yearEl.setAttribute('y', Math.min(margin.top + height - 3, yearBaseline));
          }
        };

        
        const getLabelPosition = (point, position, distance) => {
          const pointY = Math.max(margin.top + 10, Math.min(yScale(point.value), margin.top + height - 25));
          const pointX = xScale(point.year);
          
          if (position === "above") {
            return {
              valueY: Math.max(margin.top + 15, pointY - distance),
              yearY: Math.max(margin.top + 27, pointY - (distance - 12)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + 12),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + 25, pointX - 25)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - 25, pointX + 25)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startValueLabel.setAttribute("x", startPos.x);
        startValueLabel.setAttribute("y", startPos.valueY);
        startValueLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startValueLabel.setAttribute("font-size", "18");
        startValueLabel.setAttribute("font-weight", "bold");
        startValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startValueLabel.setAttribute("fill", "#000000");
        startValueLabel.textContent = startPoint.value.toFixed(1);
        svg.appendChild(startValueLabel);
        
        const startYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        startYearLabel.setAttribute("x", startPos.x);
        startYearLabel.setAttribute("y", startPos.yearY);
        startYearLabel.setAttribute("text-anchor", config.start === "left" ? "end" : config.start === "right" ? "start" : "middle");
        startYearLabel.setAttribute("font-size", "14");
        startYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        startYearLabel.setAttribute("fill", "#666666");
        startYearLabel.textContent = startPoint.year;
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endValueLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endValueLabel.setAttribute("x", endPos.x);
        endValueLabel.setAttribute("y", endPos.valueY);
        endValueLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endValueLabel.setAttribute("font-size", "18");
        endValueLabel.setAttribute("font-weight", "bold");
        endValueLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endValueLabel.setAttribute("fill", "#000000");
        endValueLabel.textContent = currentPoint.value.toFixed(1);
        svg.appendChild(endValueLabel);
        
        const endYearLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
        endYearLabel.setAttribute("x", endPos.x);
        endYearLabel.setAttribute("y", endPos.yearY);
        endYearLabel.setAttribute("text-anchor", config.end === "left" ? "end" : config.end === "right" ? "start" : "middle");
        endYearLabel.setAttribute("font-size", "14");
        endYearLabel.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        endYearLabel.setAttribute("fill", "#666666");
        endYearLabel.textContent = currentPoint.year;
        svg.appendChild(endYearLabel);

        
        adjustLabelPair(startValueLabel, startYearLabel, xScale(startPoint.year), config.start);
        adjustLabelPair(endValueLabel, endYearLabel, xScale(currentPoint.year), config.end);

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
</div>
<h2 class="heading" id="the-big-picture">
  The Big Picture
  <a class="anchor" href="#the-big-picture">#</a>
</h2>
<p>These charts represent decades of human effort, innovation, and cooperation. While challenges remain, the trajectory is clear: by most measures that matter for human wellbeing, we are making remarkable progress.</p>
<p>The data comes primarily from <a href="https://ourworldindata.org/">Our World in Data</a>, with additional sources including Gapminder, WHO, IMDb, and Discogs.</p>
<hr>
<p><em>This post is automatically updated monthly with the latest available data.</em></p>

    </div>
  </article>

  

  

  
  

<div class="single-pagination">
    <hr />

    <div class="flexnowrap">

        <div class="single-pagination-prev">
            
            <div class="single-pagination-container-prev">
                <div class="single-pagination-text"></div>
                <div class="single-pagination-text">
                    <a href="/writing/learned/">
                        What I learned at Substack
                    </a>
                </div>
            </div>
            
        </div>

        <div class="single-pagination-next">
            
        </div>

    </div>

    <hr />
</div>



  

  

  
  <div class="back-to-top">
    <a href="#top">
      back to top
    </a>
  </div>
  

</div>


    </main>
  </div>

  
  





    




  <footer>
    

    
    





    




    
    <p>Powered by
        <a href="https://gohugo.io/">Hugo</a>
        and
        <a href="https://github.com/tomfran/typo">tomfran/typo</a>
    </p>
    
    
    


  </footer>

  
</body>

<script src="/js/theme-switch.js"></script>
<script defer src="/js/copy-code.js"></script>
</html>
