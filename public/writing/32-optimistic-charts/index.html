<!DOCTYPE html>
<html lang="en-us"
  dir="ltr">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">








    






<link rel="icon" type="image/ico" href="http:/localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http:/localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http:/localhost:1313/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="192x192" href="http:/localhost:1313/android-chrome-192x192.png">
<link rel="apple-touch-icon" sizes="180x180" href="http:/localhost:1313/apple-touch-icon.png">

<meta name="description" content="Data-driven evidence that humanity is making remarkable progress across health, education, technology, and human rights."/>



<title>
    
    32 Optimistic Charts: The World is Getting Better | Dominik Dabrowski
    
</title>

<link rel="canonical" href="http://localhost:1313/writing/32-optimistic-charts/"/>

<meta property="og:url" content="http://localhost:1313/writing/32-optimistic-charts/">
  <meta property="og:site_name" content="Dominik Dabrowski">
  <meta property="og:title" content="32 Optimistic Charts: The World is Getting Better">
  <meta property="og:description" content="Data-driven evidence that humanity is making remarkable progress across health, education, technology, and human rights.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="writing">
    <meta property="article:published_time" content="2025-08-17T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-08-17T00:00:00+00:00">
    <meta property="article:tag" content="Progress">
    <meta property="article:tag" content="Data">
    <meta property="article:tag" content="Optimism">












  







<link rel="stylesheet" href="/assets/combined.min.2320aae6ebf8845da1c3f982267540bc26ec33afcdf9b101c06e070ac6838975.css" media="all">











    




</head>







<body class="auto">

  <div class="content">
    <header>
      

<div class="header">

    

    <h1 class="header-title">
        <a href="http://localhost:1313/">Dominik Dabrowski</a>
    </h1>

    <div class="header-menu">
        

        
        

        <p
            class="small ">
            <a href="/" >
                /home
            </a>
        </p>
        

        <p
            class="small ">
            <a href="/writing" >
                /writing
            </a>
        </p>
        
        
    </div>

    

</div>

    </header>

    <main class="main">
      

<script>
  
  document.documentElement.setAttribute('data-wide-layout', 'true');
</script>




<div class="breadcrumbs"><a href="/">Home</a><span class="breadcrumbs-separator">/</span><a href="/writing/">Writings</a><span class="breadcrumbs-separator">/</span>
        <a href="/writing/32-optimistic-charts/">32 Optimistic Charts: The World is Getting Better</a></div>


<div class="wide-layout" >
  <article>
    <header class="single-intro-container">
        
        <h1 class="single-title">32 Optimistic Charts: The World is Getting Better</h1>
    
        <p class="single-readtime">
          <time datetime="2025-08-17T00:00:00&#43;00:00">August 17, 2025</time>
        </p>
    </header>
    
    <div class="single-content wide-content">
      <p>The world often feels like it&rsquo;s falling apart, but the data tells a different story. Here are 32 charts showing measurable human progress across health, education, technology, environment, and human rights.</p>
<p><em>Last updated: 2025-08-17</em></p>
<h2 class="heading" id="16-bad-things-that-are-decreasing">
  16 Bad Things That Are Decreasing
  <a class="anchor" href="#16-bad-things-that-are-decreasing">#</a>
</h2>
<div class="charts-grid">
<div class="chart-section">
<h3 class="heading" id="legal-slavery">
  Legal Slavery
  <a class="anchor" href="#legal-slavery">#</a>
</h3>
<p>Number of countries where slavery is legal</p>
<div class="chart-container" id="chart-legal-slavery"><div class="chart-visualization" id="chart-viz-legal-slavery"></div>
  <script>
    (function() {
      const data = [{year:  1800 , value:  194 },{year:  1820 , value:  189 },{year:  1840 , value:  174 },{year:  1860 , value:  165 },{year:  1880 , value:  160 },{year:  1900 , value:  158 },{year:  1920 , value:  157 },{year:  1940 , value:  145 },{year:  1960 , value:  102 },{year:  1980 , value:  54 },{year:  2000 , value:  15 },{year:  2017 , value:  3 },];
      
      const direction = "down";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-legal-slavery");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ={};
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'legal-slavery'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'legal-slavery'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('legal-slavery');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "legal-slavery";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<div class="chart-section-header">
<h3 class="heading" id="maternal-deaths">
  Maternal Deaths
  <a class="anchor" href="#maternal-deaths">#</a>
</h3>
<p>Deaths per 100,000 live births</p>
</div>
<div class="chart-container" id="chart-maternal-mortality"><div class="chart-visualization" id="chart-viz-maternal-mortality"></div>
  <script>
    (function() {
      const data = [{year:  1985 , value:  428.5482 },{year:  1986 , value:  410.23654 },{year:  1987 , value:  401.5882 },{year:  1988 , value:  396.0917 },{year:  1989 , value:  384.8084 },{year:  1990 , value:  370.27313 },{year:  1991 , value:  378.09518 },{year:  1992 , value:  386.26517 },{year:  1993 , value:  385.65283 },{year:  1994 , value:  375.2249 },{year:  1995 , value:  373.19336 },{year:  1996 , value:  372.66693 },{year:  1997 , value:  365.62094 },{year:  1998 , value:  362.9174 },{year:  1999 , value:  343.77753 },{year:  2000 , value:  334.10532 },{year:  2001 , value:  329.2917 },{year:  2002 , value:  317.67972 },{year:  2003 , value:  307.0511 },{year:  2004 , value:  299.8426 },{year:  2005 , value:  291.26068 },{year:  2006 , value:  276.11456 },{year:  2007 , value:  270.64816 },{year:  2008 , value:  265.16806 },{year:  2009 , value:  258.04745 },{year:  2010 , value:  248.80334 },{year:  2011 , value:  241.46191 },{year:  2012 , value:  231.28264 },{year:  2013 , value:  228.95949 },{year:  2014 , value:  223.14148 },{year:  2015 , value:  219.4542 },{year:  2016 , value:  215.49913 },{year:  2017 , value:  213.16835 },{year:  2018 , value:  215.09969 },{year:  2019 , value:  214.92525 },{year:  2020 , value:  212.23637 },];
      
      const direction = "down";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-maternal-mortality");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ="{\"end\":\"above\",\"start\":\"below\"}";
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'maternal-mortality'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'maternal-mortality'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('maternal-mortality');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "maternal-mortality";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<div class="chart-section-header">
<h3 class="heading" id="oil-spills">
  Oil Spills
  <a class="anchor" href="#oil-spills">#</a>
</h3>
<p>1,000 tons spilled per year</p>
</div>
<div class="chart-container" id="chart-oil-spills"><div class="chart-visualization" id="chart-viz-oil-spills"></div>
  <script>
    (function() {
      const data = [{year:  1970 , value:  383 },{year:  1972 , value:  313 },{year:  1974 , value:  174 },{year:  1976 , value:  365 },{year:  1978 , value:  393 },{year:  1980 , value:  206 },{year:  1982 , value:  12 },{year:  1984 , value:  29 },{year:  1986 , value:  19 },{year:  1988 , value:  190 },{year:  1990 , value:  61 },{year:  1992 , value:  167 },{year:  1994 , value:  130 },{year:  1996 , value:  80 },{year:  1998 , value:  13 },{year:  2000 , value:  14 },{year:  2002 , value:  66 },{year:  2004 , value:  17 },{year:  2006 , value:  12 },{year:  2008 , value:  2 },{year:  2010 , value:  12 },{year:  2012 , value:  1 },{year:  2014 , value:  5 },{year:  2016 , value:  6 },{year:  2018 , value:  116 },{year:  2020 , value:  1 },{year:  2022 , value:  15 },{year:  2024 , value:  10 },];
      
      const direction = "down";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-oil-spills");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ="{\"end\":\"above\",\"start\":\"right\"}";
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'oil-spills'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'oil-spills'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('oil-spills');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "oil-spills";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<div class="chart-section-header">
<h3 class="heading" id="solar-panel-price">
  Solar Panel Price
  <a class="anchor" href="#solar-panel-price">#</a>
</h3>
<p>Average price of PV modules, $/W</p>
</div>
<div class="chart-container" id="chart-solar-price"><div class="chart-visualization" id="chart-viz-solar-price"></div>
  <script>
    (function() {
      const data = [{year:  1975 , value:  130.70473 },{year:  1977 , value:  71.74392 },{year:  1979 , value:  42.64987 },{year:  1981 , value:  28.896935 },{year:  1983 , value:  20.960136 },{year:  1985 , value:  17.003012 },{year:  1987 , value:  11.957518 },{year:  1989 , value:  11.542489 },{year:  1991 , value:  11.059409 },{year:  1993 , value:  9.635483 },{year:  1995 , value:  8.427791 },{year:  1997 , value:  7.8516297 },{year:  1999 , value:  6.5357065 },{year:  2001 , value:  6.2051206 },{year:  2003 , value:  5.3948364 },{year:  2005 , value:  4.569292 },{year:  2007 , value:  5.0173874 },{year:  2009 , value:  3.0563195 },{year:  2011 , value:  1.9594005 },{year:  2013 , value:  0.81395847 },{year:  2015 , value:  0.697721 },{year:  2017 , value:  0.5409895 },{year:  2019 , value:  0.44111046 },{year:  2021 , value:  0.31517783 },{year:  2023 , value:  0.3056964 },];
      
      const direction = "down";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-solar-price");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ="{\"end\":\"above\",\"start\":\"right\"}";
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'solar-price'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'solar-price'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('solar-price');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "solar-price";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="child-mortality">
  Child Mortality
  <a class="anchor" href="#child-mortality">#</a>
</h3>
<p>Children dying before age 5, percent</p>
<div class="chart-container" id="chart-child-mortality"><div class="chart-visualization" id="chart-viz-child-mortality"></div>
  <script>
    (function() {
      const data = [{year:  1800 , value:  42.8 },{year:  1811 , value:  42.4 },{year:  1822 , value:  42.1 },{year:  1833 , value:  42.2 },{year:  1844 , value:  42.1 },{year:  1855 , value:  44 },{year:  1866 , value:  42.1 },{year:  1877 , value:  41.2 },{year:  1888 , value:  41 },{year:  1899 , value:  40.8 },{year:  1910 , value:  36.4 },{year:  1921 , value:  34.2 },{year:  1932 , value:  30.7 },{year:  1943 , value:  27.7 },{year:  1954 , value:  22.8 },{year:  1965 , value:  15.1 },{year:  1976 , value:  12.8 },{year:  1987 , value:  9.94 },{year:  1998 , value:  8.23 },{year:  2009 , value:  5.4 },{year:  2020 , value:  3.87 },{year:  2023 , value:  3.67 },];
      
      const direction = "down";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-child-mortality");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ={};
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'child-mortality'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'child-mortality'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('child-mortality');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "child-mortality";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="battle-deaths">
  Battle Deaths
  <a class="anchor" href="#battle-deaths">#</a>
</h3>
<p>Deaths in state conflicts per 100,000 people</p>
<div class="chart-container" id="chart-battle-deaths"><div class="chart-visualization" id="chart-viz-battle-deaths"></div>
  <script>
    (function() {
      const data = [{year:  1946 , value:  1.7845484 },{year:  1949 , value:  1.761051 },{year:  1952 , value:  1.7986227 },{year:  1955 , value:  0.8757755 },{year:  1958 , value:  0.8398103 },{year:  1961 , value:  0.8482149 },{year:  1964 , value:  0.2313092 },{year:  1967 , value:  0.23980215 },{year:  1970 , value:  0.21728988 },{year:  1973 , value:  0.2496556 },{year:  1976 , value:  0 },{year:  1979 , value:  0 },{year:  1982 , value:  0 },{year:  1985 , value:  0 },{year:  1988 , value:  0 },{year:  1991 , value:  0 },{year:  1994 , value:  0 },{year:  1997 , value:  0 },{year:  2000 , value:  0 },{year:  2003 , value:  0 },{year:  2006 , value:  0 },{year:  2009 , value:  0 },{year:  2012 , value:  0 },{year:  2015 , value:  0 },{year:  2018 , value:  0 },{year:  2021 , value:  0 },{year:  2024 , value:  0 },];
      
      const direction = "down";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-battle-deaths");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ="{\"end\":\"above\",\"start\":\"right\"}";
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'battle-deaths'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'battle-deaths'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('battle-deaths');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "battle-deaths";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="co-intensity">
  CO₂ Intensity
  <a class="anchor" href="#co-intensity">#</a>
</h3>
<p>Carbon emissions per dollar of GDP</p>
<div class="chart-container" id="chart-co2-intensity"><div class="chart-visualization" id="chart-viz-co2-intensity"></div>
  <script>
    (function() {
      const data = [{year:  1820 , value:  0.043172903 },{year:  1850 , value:  0.12727068 },{year:  1870 , value:  0.27310827 },{year:  1900 , value:  0.55983275 },{year:  1920 , value:  0.7332383 },{year:  1940 , value:  0.6387778 },{year:  1950 , value:  0.7008459 },{year:  1960 , value:  0.70377547 },{year:  1970 , value:  0.6790251 },{year:  1980 , value:  0.60934746 },{year:  1990 , value:  0.5281683 },{year:  2000 , value:  0.42590228 },{year:  2010 , value:  0.3714147 },{year:  2015 , value:  0.33128375 },{year:  2016 , value:  0.32078212 },{year:  2017 , value:  0.31424102 },{year:  2018 , value:  0.30926767 },{year:  2019 , value:  0.3037615 },{year:  2020 , value:  0.29620138 },{year:  2021 , value:  0.29357404 },{year:  2022 , value:  0.28662747 },];
      
      const direction = "down";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-co2-intensity");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ={};
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'co2-intensity'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'co2-intensity'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('co2-intensity');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "co2-intensity";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="plane-crash-deaths">
  Plane Crash Deaths
  <a class="anchor" href="#plane-crash-deaths">#</a>
</h3>
<p>Aviation fatalities per million passengers</p>
<div class="chart-container" id="chart-plane-deaths"><div class="chart-visualization" id="chart-viz-plane-deaths"></div>
  <script>
    (function() {
      const data = [{year:  1970 , value:  4.767405 },{year:  1973 , value:  5.652787 },{year:  1975 , value:  2.671901 },{year:  1977 , value:  3.3354812 },{year:  1979 , value:  2.6974065 },{year:  1981 , value:  1.3440118 },{year:  1983 , value:  1.9646722 },{year:  1985 , value:  3.091172 },{year:  1987 , value:  1.4544039 },{year:  1989 , value:  1.8022621 },{year:  1991 , value:  1.0130352 },{year:  1993 , value:  1.0645514 },{year:  1995 , value:  0.9079803 },{year:  1997 , value:  0.8521726 },{year:  1999 , value:  0.4416689 },{year:  2001 , value:  0.6796638 },{year:  2003 , value:  0.3999257 },{year:  2005 , value:  0.536152 },{year:  2007 , value:  0.34945783 },{year:  2009 , value:  0.3222611 },{year:  2011 , value:  0.18036054 },{year:  2013 , value:  0.0825753 },{year:  2015 , value:  0.15233545 },{year:  2017 , value:  0.010930004 },{year:  2019 , value:  0.06396315 },{year:  2021 , value:  0.053947967 },];
      
      const direction = "down";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-plane-deaths");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ="{\"end\":\"above\",\"start\":\"left\"}";
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'plane-deaths'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'plane-deaths'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('plane-deaths');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "plane-deaths";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="disaster-deaths">
  Disaster Deaths
  <a class="anchor" href="#disaster-deaths">#</a>
</h3>
<p>Natural disaster deaths, thousands per year</p>
<div class="chart-container" id="chart-disaster-deaths"><div class="chart-visualization" id="chart-viz-disaster-deaths"></div>
  <script>
    (function() {
      const data = [{year:  1900 , value:  1261 },{year:  1910 , value:  16.99 },{year:  1914 , value:  17.04 },{year:  1922 , value:  0 },{year:  1932 , value:  0 },{year:  1936 , value:  0 },{year:  1940 , value:  4.006 },{year:  1944 , value:  4.009 },{year:  1961 , value:  0 },{year:  1966 , value:  508 },{year:  1970 , value:  0 },{year:  1974 , value:  20.427 },{year:  1978 , value:  19.774 },{year:  1982 , value:  20.988 },{year:  1986 , value:  0.084 },{year:  1990 , value:  0.042 },{year:  1994 , value:  0 },{year:  1998 , value:  0.065 },{year:  2002 , value:  0.671 },{year:  2006 , value:  0.169 },{year:  2010 , value:  10 },{year:  2014 , value:  0 },{year:  2018 , value:  0 },{year:  2022 , value:  2.601 },{year:  2024 , value:  0 },];
      
      const direction = "down";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-disaster-deaths");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ="{\"end\":\"above\",\"start\":\"right\"}";
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'disaster-deaths'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'disaster-deaths'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('disaster-deaths');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "disaster-deaths";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="nuclear-warheads">
  Nuclear Warheads
  <a class="anchor" href="#nuclear-warheads">#</a>
</h3>
<p>Global nuclear weapons, thousands</p>
<div class="chart-container" id="chart-nuclear-warheads"><div class="chart-visualization" id="chart-viz-nuclear-warheads"></div>
  <script>
    (function() {
      const data = [{year:  1945 , value:  0.006 },{year:  1949 , value:  0.236 },{year:  1953 , value:  1.557 },{year:  1957 , value:  7.162 },{year:  1961 , value:  26.752 },{year:  1965 , value:  38.419 },{year:  1969 , value:  38.278 },{year:  1973 , value:  45.695 },{year:  1977 , value:  49.698 },{year:  1981 , value:  56.53 },{year:  1985 , value:  64.408 },{year:  1989 , value:  63.657 },{year:  1993 , value:  48.83 },{year:  1997 , value:  36.776 },{year:  2001 , value:  33.19 },{year:  2005 , value:  28.358 },{year:  2009 , value:  22.524 },{year:  2013 , value:  17.68 },{year:  2017 , value:  14.54 },{year:  2021 , value:  13.1 },{year:  2024 , value:  12.121 },];
      
      const direction = "down";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-nuclear-warheads");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ={};
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'nuclear-warheads'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'nuclear-warheads'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('nuclear-warheads');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "nuclear-warheads";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="air-pollution">
  Air Pollution
  <a class="anchor" href="#air-pollution">#</a>
</h3>
<p>Sulfur dioxide emissions, kg per person</p>
<div class="chart-container" id="chart-so2-emissions"><div class="chart-visualization" id="chart-viz-so2-emissions"></div>
  <script>
    (function() {
      const data = [{year:  1750 , value:  0.3723488 },{year:  1763 , value:  0.40093775 },{year:  1776 , value:  0.46054753000000004 },{year:  1789 , value:  0.52232972 },{year:  1802 , value:  0.6605367 },{year:  1815 , value:  0.7833914399999999 },{year:  1828 , value:  1.0288655 },{year:  1841 , value:  1.6190548 },{year:  1854 , value:  2.8208438 },{year:  1867 , value:  5.153144 },{year:  1880 , value:  9.752826 },{year:  1893 , value:  15.644939 },{year:  1906 , value:  30.750544 },{year:  1919 , value:  34.120736 },{year:  1932 , value:  32.253812 },{year:  1945 , value:  47.722824 },{year:  1958 , value:  79.36942 },{year:  1971 , value:  124.51113 },{year:  1984 , value:  131.84949 },{year:  1997 , value:  117.21026 },{year:  2010 , value:  105.69075 },{year:  2022 , value:  73.46696 },];
      
      const direction = "down";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-so2-emissions");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ="{\"distanceEnd\":30,\"distanceStart\":22,\"end\":\"below\",\"start\":\"below\"}";
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'so2-emissions'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'so2-emissions'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('so2-emissions');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "so2-emissions";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="ozone-depletion">
  Ozone Depletion
  <a class="anchor" href="#ozone-depletion">#</a>
</h3>
<p>Ozone-depleting substances, thousands of tons</p>
<div class="chart-container" id="chart-ozone-depletion"><div class="chart-visualization" id="chart-viz-ozone-depletion"></div>
  <script>
    (function() {
      const data = [{year:  1986 , value:  4.6 },{year:  1989 , value:  65667.4 },{year:  1990 , value:  16754 },{year:  1991 , value:  35873.2 },{year:  1992 , value:  56687.7 },{year:  1993 , value:  38083.8 },{year:  1994 , value:  14215.7 },{year:  1995 , value:  15455.899 },{year:  1996 , value:  2896.8 },{year:  1997 , value:  2295 },{year:  1998 , value:  1732.8999 },{year:  1999 , value:  2155.7998 },{year:  2000 , value:  2119.5 },{year:  2001 , value:  1322.5 },{year:  2002 , value:  -599.49994 },{year:  2003 , value:  1330.4 },{year:  2004 , value:  799.9 },{year:  2005 , value:  618.30005 },{year:  2006 , value:  613.4 },{year:  2007 , value:  491.1 },{year:  2008 , value:  387 },{year:  2009 , value:  235.90001 },{year:  2010 , value:  -20.300003 },{year:  2011 , value:  -107.9 },{year:  2012 , value:  -117.8 },{year:  2013 , value:  -25.5 },{year:  2014 , value:  -6.1 },{year:  2015 , value:  -22.4 },{year:  2016 , value:  -31.4 },{year:  2017 , value:  -46.8 },{year:  2018 , value:  -41.2 },{year:  2019 , value:  -37.6 },{year:  2020 , value:  -32.3 },{year:  2021 , value:  -21.7 },];
      
      const direction = "down";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-ozone-depletion");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ="{\"distanceStart\":28,\"start\":\"above\"}";
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'ozone-depletion'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'ozone-depletion'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('ozone-depletion');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "ozone-depletion";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="hunger">
  Hunger
  <a class="anchor" href="#hunger">#</a>
</h3>
<p>Population undernourished, percent</p>
<div class="chart-container" id="chart-hunger"><div class="chart-visualization" id="chart-viz-hunger"></div>
  <script>
    (function() {
      const data = [{year:  2000 , value:  12.8 },{year:  2001 , value:  12.9 },{year:  2002 , value:  13.2 },{year:  2003 , value:  12.9 },{year:  2004 , value:  12.7 },{year:  2005 , value:  12.2 },{year:  2006 , value:  11.2 },{year:  2007 , value:  10.1 },{year:  2008 , value:  9.5 },{year:  2009 , value:  9.2 },{year:  2010 , value:  8.7 },{year:  2011 , value:  8.1 },{year:  2012 , value:  8 },{year:  2013 , value:  7.8 },{year:  2014 , value:  7.3 },{year:  2015 , value:  7.7 },{year:  2016 , value:  7.6 },{year:  2017 , value:  7.1 },{year:  2018 , value:  7.2 },{year:  2019 , value:  7.5 },{year:  2020 , value:  8.5 },{year:  2021 , value:  9 },{year:  2022 , value:  9.1 },{year:  2023 , value:  9.1 },];
      
      const direction = "down";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-hunger");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ={};
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'hunger'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'hunger'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('hunger');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "hunger";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="extreme-poverty">
  Extreme Poverty
  <a class="anchor" href="#extreme-poverty">#</a>
</h3>
<p>Population in extreme poverty, percent</p>
<div class="chart-container" id="chart-extreme-poverty"><div class="chart-visualization" id="chart-viz-extreme-poverty"></div>
  <script>
    (function() {
      const data = [{year:  1990 , value:  43.62347 },{year:  1991 , value:  43.308975 },{year:  1992 , value:  42.646713 },{year:  1993 , value:  42.162754 },{year:  1994 , value:  40.751804 },{year:  1995 , value:  39.29992 },{year:  1996 , value:  37.99766 },{year:  1997 , value:  37.6325 },{year:  1998 , value:  37.821438 },{year:  1999 , value:  37.296734 },{year:  2000 , value:  36.258648 },{year:  2001 , value:  35.3276 },{year:  2002 , value:  33.82348 },{year:  2003 , value:  32.322193 },{year:  2004 , value:  30.390305 },{year:  2005 , value:  28.426996 },{year:  2006 , value:  27.02685 },{year:  2007 , value:  25.348526 },{year:  2008 , value:  24.160345 },{year:  2009 , value:  23.068974 },{year:  2010 , value:  20.992023 },{year:  2011 , value:  19.143898 },{year:  2012 , value:  17.860125 },{year:  2013 , value:  15.481716 },{year:  2014 , value:  14.438818 },{year:  2015 , value:  13.338141 },{year:  2016 , value:  12.48118 },{year:  2017 , value:  11.723499 },{year:  2018 , value:  11.059525 },{year:  2019 , value:  10.694138 },{year:  2020 , value:  11.221615 },{year:  2021 , value:  10.967278 },{year:  2022 , value:  10.48834 },{year:  2023 , value:  10.192862 },{year:  2024 , value:  10.044863 },{year:  2025 , value:  9.856213 },];
      
      const direction = "down";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-extreme-poverty");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ={};
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'extreme-poverty'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'extreme-poverty'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('extreme-poverty');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "extreme-poverty";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="smoking">
  Smoking
  <a class="anchor" href="#smoking">#</a>
</h3>
<p>Share of adults who smoke</p>
<div class="chart-container" id="chart-smoking-prevalence"><div class="chart-visualization" id="chart-viz-smoking-prevalence"></div>
  <script>
    (function() {
      const data = [{year:  2000 , value:  34.32254 },{year:  2005 , value:  30.745785 },{year:  2007 , value:  29.422499 },{year:  2010 , value:  27.585884 },{year:  2015 , value:  24.878088 },{year:  2020 , value:  22.58197 },{year:  2021 , value:  22.133287 },{year:  2022 , value:  21.748646 },];
      
      const direction = "down";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-smoking-prevalence");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ={};
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'smoking-prevalence'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'smoking-prevalence'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('smoking-prevalence');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "smoking-prevalence";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="homicide-rate">
  Homicide Rate
  <a class="anchor" href="#homicide-rate">#</a>
</h3>
<p>Intentional homicides per 100,000 people</p>
<div class="chart-container" id="chart-homicide-rate"><div class="chart-visualization" id="chart-viz-homicide-rate"></div>
  <script>
    (function() {
      const data = [{year:  2000 , value:  6.930091 },{year:  2001 , value:  7.0186663 },{year:  2002 , value:  6.9801316 },{year:  2003 , value:  6.7978806 },{year:  2004 , value:  6.5749803 },{year:  2005 , value:  6.365925 },{year:  2006 , value:  6.247133 },{year:  2007 , value:  6.0740776 },{year:  2008 , value:  6.0693526 },{year:  2009 , value:  6.1153026 },{year:  2010 , value:  6.091143 },{year:  2011 , value:  6.1597085 },{year:  2012 , value:  6.1843886 },{year:  2013 , value:  6.090741 },{year:  2014 , value:  6.0830593 },{year:  2015 , value:  5.9224563 },{year:  2016 , value:  5.967355 },{year:  2017 , value:  5.894396 },{year:  2018 , value:  5.651801 },{year:  2019 , value:  5.396274 },{year:  2020 , value:  5.286739 },{year:  2021 , value:  5.511355 },{year:  2022 , value:  5.2869196 },{year:  2023 , value:  5.197053 },];
      
      const direction = "down";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-homicide-rate");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ={};
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'homicide-rate'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'homicide-rate'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('homicide-rate');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "homicide-rate";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
</div>
<h2 class="heading" id="16-good-things-that-are-increasing">
  16 Good Things That Are Increasing
  <a class="anchor" href="#16-good-things-that-are-increasing">#</a>
</h2>
<div class="charts-grid">
<div class="chart-section">
<h3 class="heading" id="scientific-research">
  Scientific Research
  <a class="anchor" href="#scientific-research">#</a>
</h3>
<p>Scholarly articles published per year</p>
<div class="chart-container" id="chart-scientific-papers"><div class="chart-visualization" id="chart-viz-scientific-papers"></div>
  <script>
    (function() {
      const data = [{year:  1996 , value:  0.9848121999999999 },{year:  1997 , value:  1.01488006 },{year:  1998 , value:  1.02047494 },{year:  1999 , value:  1.02083356 },{year:  2000 , value:  1.0710095 },{year:  2001 , value:  1.1096184 },{year:  2002 , value:  1.1580769 },{year:  2003 , value:  1.2145979 },{year:  2004 , value:  1.3279311999999999 },{year:  2005 , value:  1.489848 },{year:  2006 , value:  1.5805006000000001 },{year:  2007 , value:  1.6489861000000001 },{year:  2008 , value:  1.742799 },{year:  2009 , value:  1.8445391 },{year:  2010 , value:  1.9297711000000002 },{year:  2011 , value:  2.0280629 },{year:  2012 , value:  2.0835701 },{year:  2013 , value:  2.1497558 },{year:  2014 , value:  2.2232265 },{year:  2015 , value:  2.2756812 },{year:  2016 , value:  2.3565148 },{year:  2017 , value:  2.430534 },{year:  2018 , value:  2.5658715 },{year:  2019 , value:  2.7349617999999998 },{year:  2020 , value:  2.9330108 },];
      
      const direction = "up";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-scientific-papers");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ="{\"end\":\"below\"}";
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'scientific-papers'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'scientific-papers'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('scientific-papers');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "scientific-papers";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="food-production">
  Food Production
  <a class="anchor" href="#food-production">#</a>
</h3>
<p>Cereal crop yield, tonnes per hectare</p>
<div class="chart-container" id="chart-cereal-yield"><div class="chart-visualization" id="chart-viz-cereal-yield"></div>
  <script>
    (function() {
      const data = [{year:  1961 , value:  1.3532 },{year:  1964 , value:  1.4938002 },{year:  1967 , value:  1.6533002 },{year:  1970 , value:  1.7655001 },{year:  1973 , value:  1.9404001 },{year:  1976 , value:  2.0259001 },{year:  1979 , value:  2.1761003 },{year:  1982 , value:  2.3693001 },{year:  1985 , value:  2.5288002 },{year:  1988 , value:  2.4599 },{year:  1991 , value:  2.6832001 },{year:  1994 , value:  2.8226001 },{year:  1997 , value:  2.9945002 },{year:  2000 , value:  3.0679 },{year:  2003 , value:  3.0926003 },{year:  2006 , value:  3.3075001 },{year:  2009 , value:  3.5547001 },{year:  2012 , value:  3.6144001 },{year:  2015 , value:  3.9253001 },{year:  2018 , value:  4.0291004 },{year:  2021 , value:  4.1604 },{year:  2023 , value:  4.2426004 },];
      
      const direction = "up";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-cereal-yield");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ={};
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'cereal-yield'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'cereal-yield'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('cereal-yield');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "cereal-yield";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="adult-literacy">
  Adult Literacy
  <a class="anchor" href="#adult-literacy">#</a>
</h3>
<p>Population that can read and write, percent</p>
<div class="chart-container" id="chart-literacy"><div class="chart-visualization" id="chart-viz-literacy"></div>
  <script>
    (function() {
      const data = [{year:  1976 , value:  65.65878 },{year:  1978 , value:  66.57206 },{year:  1980 , value:  67.84755 },{year:  1982 , value:  69.04214 },{year:  1984 , value:  70.27237 },{year:  1986 , value:  71.41604 },{year:  1988 , value:  73.82409 },{year:  1990 , value:  74.90692 },{year:  1992 , value:  75.69422 },{year:  1994 , value:  76.50139 },{year:  1996 , value:  77.29624 },{year:  1998 , value:  80.46865 },{year:  2000 , value:  80.97918 },{year:  2002 , value:  81.64014 },{year:  2004 , value:  82.44724 },{year:  2006 , value:  82.42525 },{year:  2008 , value:  83.38551 },{year:  2010 , value:  84.22716 },{year:  2012 , value:  84.60138 },{year:  2014 , value:  85.28639 },{year:  2016 , value:  86.00011 },{year:  2018 , value:  86.43748 },{year:  2020 , value:  86.74745 },{year:  2022 , value:  87.15533 },{year:  2023 , value:  87.356 },];
      
      const direction = "up";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-literacy");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ={};
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'literacy'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'literacy'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('literacy');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "literacy";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="democracy">
  Democracy
  <a class="anchor" href="#democracy">#</a>
</h3>
<p>Countries that are electoral + liberal democracies (count)</p>
<div class="chart-container" id="chart-democracy"><div class="chart-visualization" id="chart-viz-democracy"></div>
  <script>
    (function() {
      const data = [{year:  1789 , value:  0 },{year:  1800 , value:  0 },{year:  1811 , value:  0 },{year:  1822 , value:  0 },{year:  1833 , value:  0 },{year:  1844 , value:  0 },{year:  1855 , value:  1 },{year:  1866 , value:  2 },{year:  1877 , value:  3 },{year:  1888 , value:  4 },{year:  1899 , value:  4 },{year:  1910 , value:  8 },{year:  1921 , value:  20 },{year:  1932 , value:  23 },{year:  1943 , value:  10 },{year:  1954 , value:  27 },{year:  1965 , value:  33 },{year:  1976 , value:  37 },{year:  1987 , value:  44 },{year:  1998 , value:  84 },{year:  2009 , value:  90 },{year:  2020 , value:  93 },{year:  2024 , value:  88 },];
      
      const direction = "up";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-democracy");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ="{\"distanceEnd\":20,\"end\":\"below\"}";
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'democracy'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'democracy'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('democracy');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "democracy";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="electricity-access">
  Electricity Access
  <a class="anchor" href="#electricity-access">#</a>
</h3>
<p>Population with electrical power, percent</p>
<div class="chart-container" id="chart-electricity"><div class="chart-visualization" id="chart-viz-electricity"></div>
  <script>
    (function() {
      const data = [{year:  1998 , value:  73.196236 },{year:  1999 , value:  74.50321 },{year:  2000 , value:  78.2214 },{year:  2001 , value:  78.71523 },{year:  2002 , value:  79.10069 },{year:  2003 , value:  79.96463 },{year:  2004 , value:  79.951706 },{year:  2005 , value:  80.700745 },{year:  2006 , value:  81.35274 },{year:  2007 , value:  81.9703 },{year:  2008 , value:  82.66719 },{year:  2009 , value:  82.86468 },{year:  2010 , value:  83.445724 },{year:  2011 , value:  84.50422 },{year:  2012 , value:  84.933945 },{year:  2013 , value:  85.70948 },{year:  2014 , value:  86.195206 },{year:  2015 , value:  86.923546 },{year:  2016 , value:  88.10383 },{year:  2017 , value:  88.9311 },{year:  2018 , value:  89.79635 },{year:  2019 , value:  90.10693 },{year:  2020 , value:  90.39738 },{year:  2021 , value:  91.33499 },{year:  2022 , value:  91.277855 },];
      
      const direction = "up";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-electricity");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ={};
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'electricity'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'electricity'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('electricity');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "electricity";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="mobile-communications">
  Mobile Communications
  <a class="anchor" href="#mobile-communications">#</a>
</h3>
<p>Mobile phone subscriptions, percent</p>
<div class="chart-container" id="chart-mobile-phones"><div class="chart-visualization" id="chart-viz-mobile-phones"></div>
  <script>
    (function() {
      const data = [{year:  1960 , value:  0 },{year:  1970 , value:  0 },{year:  1976 , value:  0 },{year:  1978 , value:  0 },{year:  1980 , value:  0.00053235854 },{year:  1982 , value:  0.0023355952 },{year:  1984 , value:  0.0068745855 },{year:  1986 , value:  0.029605433 },{year:  1988 , value:  0.08511321 },{year:  1990 , value:  0.21159427 },{year:  1992 , value:  0.4277416 },{year:  1994 , value:  0.991495 },{year:  1996 , value:  2.4996634 },{year:  1998 , value:  5.333583 },{year:  2000 , value:  12.045212 },{year:  2002 , value:  18.50668 },{year:  2004 , value:  27.264036 },{year:  2006 , value:  41.7 },{year:  2008 , value:  59.7 },{year:  2010 , value:  76.6 },{year:  2012 , value:  88.5 },{year:  2014 , value:  96.7 },{year:  2016 , value:  99.3 },{year:  2018 , value:  103.1 },{year:  2020 , value:  105.5 },{year:  2022 , value:  108.1 },{year:  2023 , value:  110.6 },];
      
      const direction = "up";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-mobile-phones");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ={};
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'mobile-phones'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'mobile-phones'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('mobile-phones');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "mobile-phones";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="clean-water">
  Clean Water
  <a class="anchor" href="#clean-water">#</a>
</h3>
<p>Population with safe water access, percent</p>
<div class="chart-container" id="chart-water-access"><div class="chart-visualization" id="chart-viz-water-access"></div>
  <script>
    (function() {
      const data = [{year:  2000 , value:  81.268005 },{year:  2001 , value:  81.60539 },{year:  2002 , value:  82.25051 },{year:  2003 , value:  82.76296 },{year:  2004 , value:  83.2708 },{year:  2005 , value:  83.76251 },{year:  2006 , value:  84.26049 },{year:  2007 , value:  84.75209 },{year:  2008 , value:  85.2404 },{year:  2009 , value:  85.71571 },{year:  2010 , value:  86.183 },{year:  2011 , value:  86.57294 },{year:  2012 , value:  87.01813 },{year:  2013 , value:  87.458954 },{year:  2014 , value:  87.893524 },{year:  2015 , value:  88.3615 },{year:  2016 , value:  88.78253 },{year:  2017 , value:  89.193 },{year:  2018 , value:  89.605576 },{year:  2019 , value:  90.004906 },{year:  2020 , value:  90.3829 },{year:  2021 , value:  90.80476 },{year:  2022 , value:  91.18254 },];
      
      const direction = "up";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-water-access");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ={};
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'water-access'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'water-access'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('water-access');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "water-access";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="internet-access">
  Internet Access
  <a class="anchor" href="#internet-access">#</a>
</h3>
<p>Population using the internet, percent</p>
<div class="chart-container" id="chart-internet"><div class="chart-visualization" id="chart-viz-internet"></div>
  <script>
    (function() {
      const data = [{year:  1990 , value:  0.048824694 },{year:  1991 , value:  0.07881051 },{year:  1992 , value:  0.12518632 },{year:  1993 , value:  0.17900668 },{year:  1994 , value:  0.36050814 },{year:  1995 , value:  0.68308204 },{year:  1996 , value:  1.3265672 },{year:  1997 , value:  2.042697 },{year:  1998 , value:  3.1405797 },{year:  1999 , value:  4.6329026 },{year:  2000 , value:  6.720288 },{year:  2001 , value:  8.022651 },{year:  2002 , value:  10.478108 },{year:  2003 , value:  12.161165 },{year:  2004 , value:  14.037434 },{year:  2005 , value:  15.6 },{year:  2006 , value:  17.3 },{year:  2007 , value:  20.3 },{year:  2008 , value:  22.8 },{year:  2009 , value:  25.4 },{year:  2010 , value:  28.5 },{year:  2011 , value:  31 },{year:  2012 , value:  33.5 },{year:  2013 , value:  35.4 },{year:  2014 , value:  37.5 },{year:  2015 , value:  39.9 },{year:  2016 , value:  42.9 },{year:  2017 , value:  45.4 },{year:  2018 , value:  48.6 },{year:  2019 , value:  53.2 },{year:  2020 , value:  59.3 },{year:  2021 , value:  62.2 },{year:  2022 , value:  64.4 },{year:  2023 , value:  67.4 },];
      
      const direction = "up";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-internet");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ="{\"distanceEnd\":18,\"end\":\"below\"}";
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'internet'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'internet'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('internet');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "internet";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="life-expectancy">
  Life Expectancy
  <a class="anchor" href="#life-expectancy">#</a>
</h3>
<p>Average lifespan at birth, years</p>
<div class="chart-container" id="chart-life-expectancy"><div class="chart-visualization" id="chart-viz-life-expectancy"></div>
  <script>
    (function() {
      const data = [{year:  1770 , value:  28.5 },{year:  1870 , value:  29.7 },{year:  1951 , value:  47.1259 },{year:  1955 , value:  50.2055 },{year:  1959 , value:  49.5818 },{year:  1963 , value:  53.7161 },{year:  1967 , value:  55.0678 },{year:  1971 , value:  56.0193 },{year:  1975 , value:  58.2681 },{year:  1979 , value:  60.1571 },{year:  1983 , value:  61.5211 },{year:  1987 , value:  63.1809 },{year:  1991 , value:  64.0642 },{year:  1995 , value:  64.8817 },{year:  1999 , value:  66.0412 },{year:  2003 , value:  67.4015 },{year:  2007 , value:  69.0316 },{year:  2011 , value:  70.4033 },{year:  2015 , value:  71.606 },{year:  2019 , value:  72.6093 },{year:  2023 , value:  73.1694 },];
      
      const direction = "up";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-life-expectancy");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ={};
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'life-expectancy'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'life-expectancy'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('life-expectancy');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "life-expectancy";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="clean-energy">
  Clean Energy
  <a class="anchor" href="#clean-energy">#</a>
</h3>
<p>Renewable electricity generation, percent</p>
<div class="chart-container" id="chart-renewable-energy"><div class="chart-visualization" id="chart-viz-renewable-energy"></div>
  <script>
    (function() {
      const data = [{year:  1985 , value:  20.817406 },{year:  1987 , value:  19.913677 },{year:  1989 , value:  18.829807 },{year:  1991 , value:  19.107336 },{year:  1993 , value:  19.706957 },{year:  1995 , value:  19.720285 },{year:  1997 , value:  19.361753 },{year:  1999 , value:  18.75384 },{year:  2001 , value:  18.045189 },{year:  2003 , value:  17.44261 },{year:  2005 , value:  18.095892 },{year:  2007 , value:  17.97301 },{year:  2009 , value:  19.471212 },{year:  2011 , value:  20.02158 },{year:  2013 , value:  21.72934 },{year:  2015 , value:  23.005732 },{year:  2017 , value:  24.497082 },{year:  2019 , value:  26.128609 },{year:  2021 , value:  28.133307 },{year:  2023 , value:  30.261606 },{year:  2024 , value:  31.918001 },];
      
      const direction = "up";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-renewable-energy");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ="{\"distanceEnd\":18,\"end\":\"below\"}";
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'renewable-energy'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'renewable-energy'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('renewable-energy');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "renewable-energy";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="improved-sanitation">
  Improved Sanitation
  <a class="anchor" href="#improved-sanitation">#</a>
</h3>
<p>Share of the population using safely managed sanitation facilities</p>
<div class="chart-container" id="chart-sanitation-access"><div class="chart-visualization" id="chart-viz-sanitation-access"></div>
  <script>
    (function() {
      const data = [{year:  2000 , value:  32.34688 },{year:  2001 , value:  32.75709 },{year:  2002 , value:  33.29103 },{year:  2003 , value:  34.117634 },{year:  2004 , value:  35.21493 },{year:  2005 , value:  36.284763 },{year:  2006 , value:  37.392464 },{year:  2007 , value:  38.566936 },{year:  2008 , value:  39.76032 },{year:  2009 , value:  40.97792 },{year:  2010 , value:  42.2104 },{year:  2011 , value:  43.40638 },{year:  2012 , value:  44.679123 },{year:  2013 , value:  45.970356 },{year:  2014 , value:  47.293365 },{year:  2015 , value:  48.638775 },{year:  2016 , value:  49.992104 },{year:  2017 , value:  51.335617 },{year:  2018 , value:  52.659065 },{year:  2019 , value:  53.972904 },{year:  2020 , value:  54.825058 },{year:  2021 , value:  55.848248 },{year:  2022 , value:  56.60437 },];
      
      const direction = "up";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-sanitation-access");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ={};
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'sanitation-access'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'sanitation-access'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('sanitation-access');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "sanitation-access";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="protected-land">
  Protected Land
  <a class="anchor" href="#protected-land">#</a>
</h3>
<p>Share of land under legal protection</p>
<div class="chart-container" id="chart-protected-land"><div class="chart-visualization" id="chart-viz-protected-land"></div>
  <script>
    (function() {
      const data = [{year:  1900 , value:  0.03 },{year:  1910 , value:  0.05 },{year:  1920 , value:  0.07 },{year:  1930 , value:  0.1 },{year:  1940 , value:  0.15 },{year:  1950 , value:  0.35 },{year:  1960 , value:  0.8 },{year:  1970 , value:  2 },{year:  1980 , value:  4.5 },{year:  1990 , value:  8.9 },{year:  2000 , value:  12 },{year:  2010 , value:  15 },{year:  2020 , value:  17 },{year:  2023 , value:  17.9 },];
      
      const direction = "up";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-protected-land");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ={};
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'protected-land'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'protected-land'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('protected-land');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "protected-land";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="womens-right-to-vote">
  Women&rsquo;s Right to Vote
  <a class="anchor" href="#womens-right-to-vote">#</a>
</h3>
<p>Number of countries where women can vote</p>
<div class="chart-container" id="chart-womens-suffrage"><div class="chart-visualization" id="chart-viz-womens-suffrage"></div>
  <script>
    (function() {
      const data = [{year:  1893 , value:  1 },{year:  1906 , value:  2 },{year:  1913 , value:  3 },{year:  1915 , value:  5 },{year:  1917 , value:  11 },{year:  1918 , value:  17 },{year:  1919 , value:  22 },{year:  1920 , value:  26 },{year:  1921 , value:  27 },{year:  1922 , value:  29 },{year:  1924 , value:  33 },{year:  1925 , value:  34 },{year:  1928 , value:  35 },{year:  1931 , value:  37 },{year:  1932 , value:  40 },{year:  1934 , value:  42 },{year:  1937 , value:  43 },{year:  1938 , value:  44 },{year:  1940 , value:  45 },{year:  1942 , value:  46 },{year:  1944 , value:  48 },{year:  1945 , value:  60 },{year:  1946 , value:  68 },{year:  1947 , value:  75 },{year:  1948 , value:  81 },{year:  1949 , value:  84 },{year:  1950 , value:  86 },{year:  1951 , value:  94 },{year:  1952 , value:  97 },{year:  1953 , value:  100 },{year:  1954 , value:  103 },{year:  1955 , value:  109 },{year:  1956 , value:  116 },{year:  1957 , value:  119 },{year:  1958 , value:  124 },{year:  1959 , value:  128 },{year:  1960 , value:  132 },{year:  1961 , value:  139 },{year:  1962 , value:  144 },{year:  1963 , value:  151 },{year:  1964 , value:  154 },{year:  1965 , value:  157 },{year:  1967 , value:  161 },{year:  1968 , value:  163 },{year:  1970 , value:  166 },{year:  1971 , value:  167 },{year:  1974 , value:  169 },{year:  1975 , value:  174 },{year:  1976 , value:  176 },{year:  1977 , value:  177 },{year:  1979 , value:  180 },{year:  1980 , value:  181 },{year:  1984 , value:  182 },{year:  1986 , value:  183 },{year:  1989 , value:  184 },{year:  1990 , value:  185 },{year:  1991 , value:  186 },{year:  1994 , value:  187 },{year:  1996 , value:  188 },{year:  1997 , value:  189 },{year:  2002 , value:  190 },{year:  2003 , value:  191 },{year:  2005 , value:  192 },{year:  2006 , value:  193 },{year:  2015 , value:  194 },{year:  2020 , value:  194 },{year:  2023 , value:  195 },];
      
      const direction = "up";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-womens-suffrage");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ={};
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'womens-suffrage'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'womens-suffrage'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('womens-suffrage');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "womens-suffrage";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="monitored-species">
  Monitored Species
  <a class="anchor" href="#monitored-species">#</a>
</h3>
<p>Number of species evaluated for conservation status</p>
<div class="chart-container" id="chart-monitored-species"><div class="chart-visualization" id="chart-viz-monitored-species"></div>
  <script>
    (function() {
      const data = [{year:  1959 , value:  34 },{year:  1960 , value:  34 },{year:  1970 , value:  50 },{year:  1980 , value:  200 },{year:  1990 , value:  2500 },{year:  1995 , value:  5000 },{year:  2000 , value:  22456 },{year:  2002 , value:  25000 },{year:  2004 , value:  45000 },{year:  2006 , value:  45000 },{year:  2010 , value:  65000 },{year:  2012 , value:  75000 },{year:  2014 , value:  90000 },{year:  2016 , value:  105000 },{year:  2018 , value:  125000 },{year:  2020 , value:  135000 },{year:  2022 , value:  150000 },{year:  2023 , value:  157190 },];
      
      const direction = "up";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-monitored-species");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ={};
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'monitored-species'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'monitored-species'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('monitored-species');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "monitored-species";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="comprehensive-vaccination">
  Comprehensive Vaccination
  <a class="anchor" href="#comprehensive-vaccination">#</a>
</h3>
<p>Share of one-year-olds with all six basic vaccines</p>
<div class="chart-container" id="chart-comprehensive-vaccination"><div class="chart-visualization" id="chart-viz-comprehensive-vaccination"></div>
  <script>
    (function() {
      const data = [{year:  2000 , value:  13 },{year:  2001 , value:  14 },{year:  2002 , value:  17 },{year:  2003 , value:  18 },{year:  2004 , value:  19 },{year:  2005 , value:  20 },{year:  2006 , value:  21 },{year:  2007 , value:  25 },{year:  2008 , value:  28 },{year:  2009 , value:  38 },{year:  2010 , value:  40 },{year:  2011 , value:  43 },{year:  2012 , value:  45 },{year:  2013 , value:  51 },{year:  2014 , value:  55 },{year:  2015 , value:  63 },{year:  2016 , value:  70 },{year:  2017 , value:  71 },{year:  2018 , value:  73 },{year:  2019 , value:  74 },{year:  2020 , value:  73 },{year:  2021 , value:  72 },{year:  2022 , value:  76 },];
      
      const direction = "up";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-comprehensive-vaccination");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ={};
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'comprehensive-vaccination'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'comprehensive-vaccination'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('comprehensive-vaccination');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "comprehensive-vaccination";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
<div class="chart-section">
<h3 class="heading" id="child-cancer-survival">
  Child Cancer Survival
  <a class="anchor" href="#child-cancer-survival">#</a>
</h3>
<p>5-year survival rate for childhood cancer</p>
<div class="chart-container" id="chart-child-cancer-survival"><div class="chart-visualization" id="chart-viz-child-cancer-survival"></div>
  <script>
    (function() {
      const data = [{year:  1975 , value:  58 },{year:  1980 , value:  60 },{year:  1985 , value:  63 },{year:  1990 , value:  66 },{year:  1995 , value:  70 },{year:  2000 , value:  75 },{year:  2005 , value:  78 },{year:  2010 , value:  80 },];
      
      const direction = "up";
      
      
      
      
      let startPoint, currentPoint;
      if (direction === "down") {
        startPoint = data.reduce((max, p) => p.value > max.value ? p : max);
      } else {
        startPoint = data.reduce((min, p) => p.value < min.value ? p : min);
      }
      currentPoint = data[data.length - 1];
      
      const showArrow = Math.abs(startPoint.value - currentPoint.value) > 0.01 && 
                       startPoint.year !== currentPoint.year;
      
      
      const margin = {top: 45, right: 40, bottom: 40, left: 50};
      const width = 500 - margin.left - margin.right;
      const height = 120;
      const svgHeight = 250; 
      
      
      const container = document.getElementById("chart-viz-child-cancer-survival");
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.setAttribute("width", "100%");
      svg.setAttribute("height", svgHeight);
      svg.setAttribute("viewBox", `0 0 500 ${svgHeight}`);
      svg.style.fontFamily = "Helvetica, Arial, sans-serif";
      svg.style.fontSize = "10px";
      
      
      const xExtent = [Math.min(...data.map(d => d.year)), Math.max(...data.map(d => d.year))];
      const yExtent = [0, Math.max(...data.map(d => d.value))];
      
      const xScale = (year) => margin.left + ((year - xExtent[0]) / (xExtent[1] - xExtent[0])) * width;
      const yScale = (value) => margin.top + ((yExtent[1] - value) / (yExtent[1] - yExtent[0])) * height;
      
      
      let areaPath = `M ${xScale(data[0].year)} ${yScale(0)}`;
      data.forEach(d => {
        areaPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      areaPath += ` L ${xScale(data[data.length - 1].year)} ${yScale(0)} Z`;
      
      
      const area = document.createElementNS("http://www.w3.org/2000/svg", "path");
      area.setAttribute("d", areaPath);
      area.setAttribute("fill", "#93432c");
      area.setAttribute("fill-opacity", "0.1");
      svg.appendChild(area);
      
      
      let linePath = `M ${xScale(data[0].year)} ${yScale(data[0].value)}`;
      data.slice(1).forEach(d => {
        linePath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
      });
      
      
      const line = document.createElementNS("http://www.w3.org/2000/svg", "path");
      line.setAttribute("d", linePath);
      line.setAttribute("stroke", "#6b3a24");
      line.setAttribute("stroke-width", "1");
      line.setAttribute("fill", "none");
      svg.appendChild(line);
      
      
      const xAxisY = yScale(0);
      
      
      const xTicks = [
        xExtent[0], 
        Math.round((xExtent[0] + xExtent[1]) / 2), 
        xExtent[1]
      ];
      
      xTicks.forEach(year => {
        const x = xScale(year);
        
        
        const tick = document.createElementNS("http://www.w3.org/2000/svg", "line");
        tick.setAttribute("x1", x);
        tick.setAttribute("y1", xAxisY);
        tick.setAttribute("x2", x);
        tick.setAttribute("y2", xAxisY + 3);
        tick.setAttribute("stroke", "#93432c");
        tick.setAttribute("stroke-width", "1");
        svg.appendChild(tick);
        
        
        const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
        label.setAttribute("x", x);
        label.setAttribute("y", xAxisY + 15);
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("font-size", "10");
        label.setAttribute("font-family", "Helvetica, Arial, sans-serif");
        label.setAttribute("fill", "#93432c");
        label.textContent = year;
        svg.appendChild(label);
      });
      
      
      const xAxisLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
      xAxisLine.setAttribute("x1", margin.left);
      xAxisLine.setAttribute("y1", xAxisY);
      xAxisLine.setAttribute("x2", margin.left + width);
      xAxisLine.setAttribute("y2", xAxisY);
      xAxisLine.setAttribute("stroke", "#93432c");
      xAxisLine.setAttribute("stroke-width", "1");
      svg.appendChild(xAxisLine);

      
      
      
      if (showArrow) {
        const progressData = data.filter(d => d.year >= startPoint.year && d.year <= currentPoint.year);
        let progressPath = `M ${xScale(progressData[0].year)} ${yScale(progressData[0].value)}`;
        progressData.slice(1).forEach(d => {
          progressPath += ` L ${xScale(d.year)} ${yScale(d.value)}`;
        });
        
        const progressLine = document.createElementNS("http://www.w3.org/2000/svg", "path");
        progressLine.setAttribute("d", progressPath);
        progressLine.setAttribute("stroke", "#6b3a24");
        progressLine.setAttribute("stroke-width", "4");
        progressLine.setAttribute("stroke-opacity", "0.8");
        progressLine.setAttribute("fill", "none");
        progressLine.setAttribute("marker-end", "url(#arrow)");
        svg.appendChild(progressLine);
        
        
        const startDot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        startDot.setAttribute("cx", xScale(startPoint.year));
        startDot.setAttribute("cy", yScale(startPoint.value));
        startDot.setAttribute("r", "3");
        startDot.setAttribute("fill", "#6b3a24");
        startDot.setAttribute("stroke", "#fff3dd");
        startDot.setAttribute("stroke-width", "1");
        svg.appendChild(startDot);
        
        
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        const marker = document.createElementNS("http://www.w3.org/2000/svg", "marker");
        marker.setAttribute("id", "arrow");
        marker.setAttribute("viewBox", "0 0 7 6");
        marker.setAttribute("refX", "0");
        marker.setAttribute("refY", "3");
        marker.setAttribute("markerWidth", "4");
        marker.setAttribute("markerHeight", "3");
        marker.setAttribute("orient", "auto");
        marker.setAttribute("markerUnits", "strokeWidth");
        
        const arrowPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        arrowPath.setAttribute("d", "M0,0 L0,6 L7,3 z");
        arrowPath.setAttribute("fill", "#6b3a24");
        arrowPath.setAttribute("fill-opacity", "0.8");
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.insertBefore(defs, svg.firstChild);
        
        
        const config = (direction === "down")
          ? { start: "below", end: "above" }
          : { start: "above", end: "below" };

        
        const override ={};
        
        const parsedOverride = typeof override === 'string' ? JSON.parse(override) : override;
        if (parsedOverride.start) config.start = parsedOverride.start;
        if (parsedOverride.end) config.end = parsedOverride.end;
        
        try { container.dataset.override = JSON.stringify(parsedOverride); } catch (e) {}

        
        let distanceAbove = 24;   
        let distanceBelow = 12;   
        let distanceHoriz = 10;   
        
        if (parsedOverride.distance !== undefined) { distanceAbove = parsedOverride.distance; distanceBelow = parsedOverride.distance; distanceHoriz = parsedOverride.distance; }
        if (parsedOverride.distanceAbove !== undefined) distanceAbove = parsedOverride.distanceAbove;
        if (parsedOverride.distanceBelow !== undefined) distanceBelow = parsedOverride.distanceBelow;
        if (parsedOverride.distanceHorizontal !== undefined) distanceHoriz = parsedOverride.distanceHorizontal;

        
        const mapSideToBase = (side) => (side === 'above' ? distanceAbove : side === 'below' ? distanceBelow : distanceHoriz);
        let startDistance = (parsedOverride.distanceStart !== undefined) ? parsedOverride.distanceStart : mapSideToBase(config.start);
        let endDistance = (parsedOverride.distanceEnd !== undefined) ? parsedOverride.distanceEnd : mapSideToBase(config.end);
        
        startDistance = Number(startDistance);
        endDistance = Number(endDistance);

        
        const labelGap = 12;

        
        const allowedSides = ['above','below','left','right'];
        const fallbackStart = (direction === 'down') ? 'below' : 'above';
        const fallbackEnd = (direction === 'down') ? 'above' : 'below';
        if (!allowedSides.includes(config.start)) {
          console && console.warn && console.warn(`Unknown start side '${config.start}' for ${'child-cancer-survival'}; falling back to ${fallbackStart}`);
          config.start = fallbackStart;
        }
        if (!allowedSides.includes(config.end)) {
          console && console.warn && console.warn(`Unknown end side '${config.end}' for ${'child-cancer-survival'}; falling back to ${fallbackEnd}`);
          config.end = fallbackEnd;
        }

        
        const percentageCharts = ['child-mortality', 'hunger', 'extreme-poverty', 'protected-areas', 'protected-land', 'literacy', 'girls-school', 'electricity', 'mobile-phones', 'water-access', 'internet', 'renewable-energy', 'comprehensive-vaccination', 'child-cancer-survival'];
        const isPercentageChart = percentageCharts.includes('child-cancer-survival');
        
        const formatValue = (value) => {
          
          let formatted;
          if (value < 0.1 && value > 0) {
            formatted = value.toFixed(2);
          } else {
            formatted = value.toFixed(1);
          }
          const cleanFormatted = formatted.endsWith('.0') ? formatted.slice(0, -2) : formatted;
          return isPercentageChart ? cleanFormatted + '%' : cleanFormatted;
        };
        
        const anchorForSide = (side) => (side === 'left' ? 'end' : side === 'right' ? 'start' : 'middle');
        const createText = (x, y, text, opts = {}) => {
          const el = document.createElementNS("http://www.w3.org/2000/svg", "text");
          el.setAttribute('x', x);
          el.setAttribute('y', y);
          if (opts.anchor) el.setAttribute('text-anchor', opts.anchor);
          if (opts.size) el.setAttribute('font-size', String(opts.size));
          if (opts.weight) el.setAttribute('font-weight', opts.weight);
          el.setAttribute('font-family', 'Helvetica, Arial, sans-serif');
          if (opts.fill) el.setAttribute('fill', opts.fill);
          if (opts.class) el.setAttribute('class', opts.class);
          el.textContent = text;
          return el;
        };

        

        
        const getLabelPosition = (point, position, distance) => {
          const actualPointY = yScale(point.value);
          const pointX = xScale(point.year);
          
          
          let pointY = actualPointY;
          if (position === "above" || position === "below") {
            
            pointY = Math.max(margin.top + 10, actualPointY);
          } else {
            
            pointY = Math.max(margin.top + 10, Math.min(actualPointY, margin.top + height - 25));
          }
          
          if (position === "above") {
            return {
              valueY: Math.max(5, pointY - distance),
              yearY: Math.max(17, pointY - (distance - labelGap)),
              x: pointX
            };
          } else if (position === "below") {
            return {
              valueY: Math.min(margin.top + height - 15, pointY + distance),
              yearY: Math.min(margin.top + height - 3, pointY + distance + labelGap),
              x: pointX
            };
          } else if (position === "left") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.max(margin.left + distance, pointX - distance)
            };
          } else if (position === "right") {
            return {
              valueY: pointY - 6,
              yearY: pointY + 6,
              x: Math.min(margin.left + width - distance, pointX + distance)
            };
          }
        };
        
        
        const startPos = getLabelPosition(startPoint, config.start, startDistance);
        const startAnchor = anchorForSide(config.start);
        const startValueLabel = createText(startPos.x, startPos.valueY, formatValue(startPoint.value), {
          anchor: startAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const startYearLabel = createText(startPos.x, startPos.yearY, String(startPoint.year), {
          anchor: startAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(startValueLabel);
        svg.appendChild(startYearLabel);

        
        const endPos = getLabelPosition(currentPoint, config.end, endDistance);
        const endAnchor = anchorForSide(config.end);
        const endValueLabel = createText(endPos.x, endPos.valueY, formatValue(currentPoint.value), {
          anchor: endAnchor, size: 18, weight: 'bold', fill: '#6b3a24', class: 'chart-label chart-label-value'
        });
        const endYearLabel = createText(endPos.x, endPos.yearY, String(currentPoint.year), {
          anchor: endAnchor, size: 14, fill: '#93432c', class: 'chart-label chart-label-year'
        });
        svg.appendChild(endValueLabel);
        svg.appendChild(endYearLabel);

        

        
        if (config.start === 'left' || config.start === 'right') {
          const sx = (config.start === 'right')
            ? Math.min(margin.left + width - startDistance, xScale(startPoint.year) + startDistance)
            : Math.max(margin.left + startDistance, xScale(startPoint.year) - startDistance);
          startValueLabel.setAttribute('x', sx);
          startYearLabel.setAttribute('x', sx);
        }
        if (config.end === 'left' || config.end === 'right') {
          const ex = (config.end === 'right')
            ? Math.min(margin.left + width - endDistance, xScale(currentPoint.year) + endDistance)
            : Math.max(margin.left + endDistance, xScale(currentPoint.year) - endDistance);
          endValueLabel.setAttribute('x', ex);
          endYearLabel.setAttribute('x', ex);
        }

        
        try {
          const chartId = "child-cancer-survival";
          const spx = xScale(startPoint.year);
          const epx = xScale(currentPoint.year);
          
          container.parentElement?.setAttribute('data-chart-id', chartId);
          container.parentElement?.setAttribute('data-start-side', String(config.start));
          container.parentElement?.setAttribute('data-end-side', String(config.end));
          container.parentElement?.setAttribute('data-start-distance', String(startDistance));
          container.parentElement?.setAttribute('data-end-distance', String(endDistance));
          container.parentElement?.setAttribute('data-start-point-x', String(spx));
          container.parentElement?.setAttribute('data-end-point-x', String(epx));
          container.parentElement?.setAttribute('data-start-label-x', String(startValueLabel.getAttribute('x')));
          container.parentElement?.setAttribute('data-end-label-x', String(endValueLabel.getAttribute('x')));

          
          startValueLabel.setAttribute('data-role', 'start-value');
          startYearLabel.setAttribute('data-role', 'start-year');
          endValueLabel.setAttribute('data-role', 'end-value');
          endYearLabel.setAttribute('data-role', 'end-year');
          startValueLabel.setAttribute('data-x', String(startValueLabel.getAttribute('x')));
          endValueLabel.setAttribute('data-x', String(endValueLabel.getAttribute('x')));

          
          if (console && console.debug) {
            console.debug(`[chart ${chartId}] start: side=${config.start}, dist=${startDistance}, pointX=${spx}, labelX=${startValueLabel.getAttribute('x')}`);
            console.debug(`[chart ${chartId}]   end: side=${config.end}, dist=${endDistance}, pointX=${epx}, labelX=${endValueLabel.getAttribute('x')}`);
          }
        } catch (_) {}

      }
      
      container.appendChild(svg);
    })();
  </script></div>
</div>
</div>
<h2 class="heading" id="the-big-picture">
  The Big Picture
  <a class="anchor" href="#the-big-picture">#</a>
</h2>
<p>These charts represent decades of human effort, innovation, and cooperation. While challenges remain, the trajectory is clear: by most measures that matter for human wellbeing, we are making remarkable progress.</p>
<p>The data comes primarily from <a href="https://ourworldindata.org/">Our World in Data</a>, with additional sources including Gapminder, WHO, IMDb, and Discogs.</p>
<hr>
<p><em>This post is automatically updated monthly with the latest available data.</em></p>

    </div>
  </article>

  

  

  
  

<div class="single-pagination">
    <hr />

    <div class="flexnowrap">

        <div class="single-pagination-prev">
            
            <div class="single-pagination-container-prev">
                <div class="single-pagination-text">←</div>
                <div class="single-pagination-text">
                    <a href="/writing/learned/">
                        What I learned at Substack
                    </a>
                </div>
            </div>
            
        </div>

        <div class="single-pagination-next">
            
        </div>

    </div>

    <hr />
</div>



  

  

  
  <div class="back-to-top">
    <a href="#top">
      back to top
    </a>
  </div>
  

</div>


    </main>
  </div>

  
  





    




  <footer>
    

    
    





    




    
    <p>Powered by
        <a href="https://gohugo.io/">Hugo</a>
        and
        <a href="https://github.com/tomfran/typo">tomfran/typo</a>
    </p>
    
    
    


  </footer>

  
</body>

<script src="/js/theme-switch.js"></script>
<script defer src="/js/copy-code.js"></script>
</html>
